<extend name="Public:base" />
<block name="title">优惠券管理</block>
<block name="content">
    <style>
        .badge-type { display:inline-block; padding:2px 10px; border-radius:4px; color:#fff; font-size:12px; }
        .badge-percent { background:#1677ff; }
        .badge-fixed { background:#fa8c16; }
        .toggle-btn { cursor:pointer; }
        @media (max-width:768px) {
            .page-header h1 { font-size:1.2rem!important; padding:10px 0!important; }
            .table { font-size:14px!important; }
            .table th,.table td { padding:8px 6px!important; word-break:break-word!important; }
            .btn { font-size:14px!important; padding:8px 12px!important; border-radius:6px!important; margin:2px!important; }
            .nav-tabs { display:flex!important; overflow:hidden!important; }
            .nav-tabs li { flex:1!important; }
            .nav-tabs li a { font-size:14px!important; padding:12px 8px!important; text-align:center!important; }
        }
        @media (min-width:769px) { .mobile-only { display:none!important; } }
    </style>
    <!-- 面包屑导航 -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}"><i class="fa fa-home"></i> 首页</a>
            </li>
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">后台管理</a>
            </li>
            <li class="breadcrumb-item active">优惠券管理</li>
        </ol>
    </nav>
    <!-- 页面导航路径 -->
    <div class="page-navigation">
        <a href="{:U('Admin/Index/index')}" class="nav-item"><i class="fa fa-home"></i> 首页</a>
        <div class="nav-separator">/</div>
        <a href="{:U('Admin/Index/index')}" class="nav-item">后台管理</a>
        <div class="nav-separator">/</div>
        <div class="nav-item active">优惠券管理</div>
    </div>
    <div class="page-content">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-start">
                    <ul class="nav nav-tabs border-0">
                        <li class="nav-item">
                            <a class="nav-link active" href="{:U('Admin/Coupon/index')}">优惠券列表</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{:U('Admin/Coupon/add')}">添加优惠券</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
            <div class="tab-content">
                <table class="table table-striped table-bordered table-hover table-condensed">
                    <tr>
                        <th width="4%">ID</th>
                        <th width="9%">优惠码</th>
                        <th>名称</th>
                        <th width="8%">类型</th>
                        <th width="7%">折扣值</th>
                        <th width="8%">最低消费</th>
                        <th width="14%">有效期</th>
                        <th width="8%">已用/总量</th>
                        <th width="6%">状态</th>
                        <th width="16%">操作</th>
                    </tr>
                    <foreach name="list" item="v">
                        <tr>
                            <td>{$v['id']}</td>
                            <td><code>{$v['code']}</code></td>
                            <td>{$v['name']}</td>
                            <td>
                                <if condition="$v['type'] eq 1"><span class="badge-type badge-percent">百分比</span></if>
                                <if condition="$v['type'] eq 2"><span class="badge-type badge-fixed">固定额</span></if>
                            </td>
                            <td>{$v['discount_fmt']}</td>
                            <td>¥{$v['min_amount']}</td>
                            <td style="font-size:12px;">{$v['valid_from_fmt']}<br/>~ {$v['valid_until_fmt']}</td>
                            <td>{$v['quantity_fmt']}</td>
                            <td>{$v['status_text']}</td>
                            <td style="min-width:160px;">
                                <div style="display:flex; gap:4px; flex-wrap:wrap;">
                                    <a class="btn btn-xs btn-warning" href="{:U('Admin/Coupon/edit',array('id'=>$v['id']))}">编辑</a>
                                    <a class="btn btn-xs btn-danger" onClick="return confirm('确定删除该优惠券?');" href="{:U('Admin/Coupon/del',array('id'=>$v['id']))}">删除</a>
                                    <button class="btn btn-xs toggle-btn {$v['is_active']?'btn-success':'btn-default'}" data-id="{$v['id']}">{$v['is_active']?'已启用':'已禁用'}</button>
                                </div>
                            </td>
                        </tr>
                    </foreach>
                </table>
            </div>
            </div>
        </div>
    </div>
    <script src="__PUBLIC__/statics/js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
    $(function(){
        $('.toggle-btn').click(function(){
            var btn = $(this);
            var id = btn.data('id');
            $.ajax({
                url: "{:U('Admin/Coupon/toggle')}",
                type: 'post',
                data: {id: id},
                dataType: 'json',
                success: function(res){
                    if(res.code == 0){
                        alert(res.msg);
                        location.reload();
                    } else {
                        alert(res.msg);
                    }
                }
            });
        });
    });
    </script>
</block>
