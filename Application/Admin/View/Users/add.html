<extend name="Public:base"/>
<block name="title">添加用户</block>
<block name="css">
    <icheckcss />
    <webuploadercss />
    <style>
        /* 面包屑导航设计 */
        .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
        }
        
        .breadcrumb-item a {
            color: #1677ff;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.3s ease;
        }
        
        .breadcrumb-item a:hover {
            color: #0958d9;
            text-decoration: none;
        }
        
        .breadcrumb-item.active {
            color: #8c8c8c;
        }
        
        .breadcrumb-item i {
            font-size: 14px;
        }
        
        .breadcrumb-item:not(:last-child)::after {
            content: '/';
            color: #d9d9d9;
            margin-left: 8px;
            font-size: 12px;
        }
        
        /* 选项卡样式 - 并排排列 */
        .nav-tabs {
            border-bottom: none;
            margin-bottom: 20px;
            background: transparent;
            display: flex;
            flex-direction: row;
            align-items: center;
        }
        
        .nav-tabs .nav-item {
            margin-right: 8px;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #595959;
            padding: 12px 20px;
            border-radius: 6px;
            background: #f5f5f5;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .nav-tabs .nav-link.active {
            background: #1677ff;
            color: white;
            border: none;
            box-shadow: 0 2px 8px rgba(22, 119, 255, 0.3);
        }
        
        .nav-tabs .nav-link:hover {
            background: #e6f7ff;
            color: #1677ff;
            transform: translateY(-1px);
        }
        
        /* 页面导航路径 */
        .page-navigation {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .page-navigation .nav-item {
            display: flex;
            align-items: center;
            color: #6c757d;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .page-navigation .nav-item:hover {
            color: #1677ff;
            text-decoration: none;
        }
        
        .page-navigation .nav-item.active {
            color: #1677ff;
            font-weight: 500;
        }
        
        .page-navigation .nav-separator {
            color: #dee2e6;
            margin: 0 4px;
        }
        
        /* 卡片样式 */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .card-header {
            background: #fafafa;
            border-bottom: 1px solid #f0f0f0;
            padding: 16px 20px;
            font-weight: 500;
        }
        
        /* 响应式处理 */
        @media (max-width: 768px) {
            .breadcrumb {
                display: none !important;
            }
            
            .page-navigation {
                font-size: 12px;
                padding: 8px 12px;
                margin-bottom: 15px;
            }
        }
        /* CSS变量定义 */
        :root {
            --primary: #3b82f6;
            --primary-dark: #1d4ed8;
            --success: #10b981;
            --success-dark: #059669;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --transition: all 0.2s ease-in-out;
        }
        
        /* 桌面端表单样式 */
        @media (min-width: 769px) {
            .form-horizontal {
                background: var(--bg-primary);
                border-radius: var(--radius-xl);
                padding: 2rem;
                box-shadow: var(--shadow);
                border: 1px solid var(--border-light);
            }
            
            .form-horizontal .form-group {
                margin-bottom: 1.5rem;
            }
            
            .form-horizontal .control-label {
                font-weight: 600;
                color: var(--text-primary);
                font-size: 0.875rem;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }
            
            .form-horizontal input[type="text"],
            .form-horizontal input[type="password"] {
                padding: 0.75rem 1rem;
                border: 1px solid var(--border);
                border-radius: var(--radius);
                font-size: 0.875rem;
                background: var(--bg-primary);
                color: var(--text-primary);
                transition: var(--transition);
            }
            
            .form-horizontal input[type="text"]:focus,
            .form-horizontal input[type="password"]:focus {
                outline: none;
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            }
            
            .form-horizontal .btn {
                padding: 0.75rem 2rem;
                font-size: 0.875rem;
                border-radius: var(--radius);
                font-weight: 600;
                transition: var(--transition);
            }
            
            .form-horizontal .btn-info {
                background: var(--primary);
                border-color: var(--primary);
                color: white;
            }
            
            .form-horizontal .btn-info:hover {
                background: var(--primary-dark);
                border-color: var(--primary-dark);
            }
            
            .widget-box {
                background: var(--bg-secondary);
                border: 1px solid var(--border-light);
                border-radius: var(--radius-lg);
                box-shadow: var(--shadow);
            }
            
            .widget-header {
                background: var(--bg-primary);
                border-bottom: 1px solid var(--border-light);
                border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            }
            
            .widget-title {
                color: var(--text-primary);
                font-weight: 600;
            }
        }
        
        /* 手机端样式 */
        @media (max-width: 768px) {
            .page-header h1 {
                font-size: 1.1rem;
                padding: 10px 0;
            }
            .tabbable {
                padding: 0 5px;
            }
            
            /* 隐藏桌面端表单 */
            .form-horizontal {
                display: none;
            }
            
            /* 隐藏桌面端表单容器 */
            .tab-pane {
                display: none;
            }
            
            /* 隐藏桌面端帮助信息 */
            .widget-box {
                display: none;
            }
            
            /* 优化页面布局 */
            .col-xs-12 {
                padding: 0 10px;
            }
            
            /* 面包屑导航优化 */
            .breadcrumb {
                background: transparent;
                padding: 8px 0;
                margin-bottom: 15px;
                font-size: 12px;
            }
            
            .breadcrumb li {
                display: inline-block;
            }
            
            .breadcrumb li:not(:last-child):after {
                content: ">";
                margin: 0 5px;
                color: #999;
            }
            
            /* 手机端表单样式 */
            .mobile-form {
                display: block;
                background: #fff;
                border-radius: 12px;
                padding: 20px;
                margin: 20px 0;
                box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            }
            
            .mobile-form-group {
                margin-bottom: 20px;
            }
            
            .mobile-form-label {
                display: block;
                font-size: 14px;
                font-weight: 500;
                color: #333;
                margin-bottom: 8px;
            }
            
            .mobile-form-input {
                width: 100%;
                padding: 12px;
                border: 1px solid #dee2e6;
                border-radius: 8px;
                font-size: 14px;
                background: #fff;
                transition: all 0.2s ease;
            }
            
            .mobile-form-input:focus {
                outline: none;
                border-color: #42a5f5;
                box-shadow: 0 0 0 2px rgba(66, 165, 245, 0.2);
            }
            
            .mobile-form-help {
                font-size: 14px;
                color: #666;
                margin-top: 5px;
            }
            
            .mobile-form-radio-group {
                display: flex;
                gap: 20px;
                margin-top: 10px;
            }
            
            .mobile-form-radio {
                display: flex;
                align-items: center;
                gap: 8px;
                font-size: 14px;
            }
            
            .mobile-form-radio input[type="radio"] {
                transform: scale(1.2);
            }
            
            .mobile-form-submit {
                width: 100%;
                padding: 15px;
                font-size: 14px;
                border-radius: 8px;
                border: none;
                background: #28a745;
                color: #fff;
                cursor: pointer;
                transition: all 0.2s ease;
                margin-bottom: 10px;
            }
            
            .mobile-form-submit:hover {
                background: #218838;
            }
            
            .mobile-form-submit:active {
                transform: scale(0.98);
            }
            
            .mobile-form-back {
                width: 100%;
                padding: 15px;
                font-size: 16px;
                border-radius: 8px;
                border: 1px solid #dee2e6;
                background: #fff;
                color: #666;
                cursor: pointer;
                transition: all 0.2s ease;
                text-decoration: none;
                text-align: center;
                display: block;
            }
            
            .mobile-form-back:hover {
                background: #f8f9fa;
                color: #333;
            }
            
            /* 手机端帮助信息 */
            .mobile-help {
                display: block;
                background: #f8f9fa;
                border-radius: 12px;
                padding: 20px;
                margin: 20px 0;
                border: 1px solid #e9ecef;
            }
            
            .mobile-help-title {
                font-size: 18px;
                font-weight: bold;
                color: #333;
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 8px;
            }
            
            .mobile-help-section {
                margin-bottom: 15px;
            }
            
            .mobile-help-section-title {
                font-size: 16px;
                font-weight: 500;
                color: #333;
                margin-bottom: 8px;
                display: flex;
                align-items: center;
                gap: 6px;
            }
            
            .mobile-help-list {
                list-style: none;
                padding: 0;
                margin: 0;
            }
            
            .mobile-help-list li {
                padding: 5px 0;
                color: #666;
                font-size: 14px;
                position: relative;
                padding-left: 20px;
            }
            
            .mobile-help-list li:before {
                content: "•";
                color: #42a5f5;
                font-weight: bold;
                position: absolute;
                left: 0;
            }
        }
        
        /* 单表单响应式：小屏下表单纵向排列 */
        @media (max-width: 768px) {
            .form-horizontal .col-sm-3, .form-horizontal .col-sm-9 { width: 100%; max-width: 100%; }
            .form-horizontal .form-group { display: block; }
            .form-horizontal .clearfix.form-actions .col-md-offset-3 { margin-left: 0; }
            .form-horizontal .clearfix.form-actions .col-md-9 { width: 100%; }
        }
        
        @media (max-width: 768px) {
            .nav-tabs {
                display: flex;
                background: #fff;
                border-bottom: 2px solid #e9ecef;
                margin-bottom: 20px;
                border-radius: 8px 8px 0 0;
                overflow: hidden;
            }
            
            .nav-tabs li {
                flex: 1;
                margin: 0;
            }
            
            .nav-tabs li a {
                display: block;
                padding: 15px 10px;
                text-align: center;
                font-size: 16px;
                font-weight: 500;
                color: #666;
                background: #f8f9fa;
                border: none;
                border-radius: 0;
                text-decoration: none;
                transition: all 0.3s ease;
                border-bottom: 3px solid transparent;
            }
            
            .nav-tabs li.active a {
                background: #42a5f5;
                color: #fff;
                border-bottom-color: #1976d2;
            }
            
            .nav-tabs li a:hover {
                background: #e3f2fd;
                color: #1976d2;
            }
        }
        
        /* 桌面端表单样式优化 - 参考payedit.html */
        @media (min-width: 769px) {
            .form-horizontal .form-group {
                margin-bottom: 20px !important;
                display: flex !important;
                align-items: flex-start !important;
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                overflow: hidden;
            }
            
            .form-horizontal .control-label {
                text-align: left !important;
                width: 150px !important;
                min-width: 150px !important;
                padding: 15px 20px !important;
                background: #f8f9fa !important;
                border: 1px solid #dee2e6 !important;
                font-weight: 600 !important;
                color: #495057 !important;
                font-size: 14px !important;
                margin: 0 !important;
                display: flex !important;
                align-items: center !important;
                border-radius: 0 !important;
                flex-shrink: 0 !important;
            }
            
            .form-horizontal .form-group > div:last-child {
                flex: 1 !important;
                border: 1px solid #dee2e6 !important;
                border-left: none !important;
                background: white !important;
                padding: 15px 20px !important;
                margin: 0 !important;
            }
            
            /* 输入框样式优化 */
            .form-horizontal input[type="text"],
            .form-horizontal input[type="password"] {
                width: 100% !important;
                min-width: 500px !important;
                padding: 12px 15px !important;
                border: 1px solid #ced4da !important;
                border-radius: 6px !important;
                font-size: 14px !important;
                line-height: 1.5 !important;
                transition: border-color 0.3s ease, box-shadow 0.3s ease !important;
                background: #fafafa !important;
                margin: 0 !important;
                max-width: none !important;
            }
            
            .form-horizontal input[type="text"]:focus,
            .form-horizontal input[type="password"]:focus {
                outline: none !important;
                border-color: #1677ff !important;
                box-shadow: 0 0 0 3px rgba(22, 119, 255, 0.1) !important;
                background: white !important;
            }
            
            /* 单选框区域优化 */
            .form-horizontal .radio {
                margin-bottom: 10px;
            }
            
            .form-horizontal .radio label {
                font-size: 14px;
                color: #495057;
                font-weight: 500;
            }
            
            /* 按钮样式优化 */
            .form-horizontal .btn {
                padding: 12px 24px !important;
                font-size: 14px !important;
                font-weight: 500 !important;
                border-radius: 6px !important;
                transition: all 0.3s ease !important;
            }
            
            .form-horizontal .btn-info {
                background: #1677ff !important;
                border-color: #1677ff !important;
                color: white !important;
            }
            
            .form-horizontal .btn-info:hover {
                background: #0958d9 !important;
                border-color: #0958d9 !important;
                transform: translateY(-1px);
                box-shadow: 0 4px 8px rgba(22, 119, 255, 0.3);
            }
            
            /* 帮助文本样式 */
            .help-inline .middle {
                font-size: 12px;
                color: #6c757d;
                margin-top: 5px;
                display: block;
            }
        }
    </style>
</block>
<block name="content">
    <!-- 成功/失败提示框 -->
    <div id="success-message" class="alert alert-success" style="display: none; position: fixed; top: 20px; right: 20px; z-index: 9999;">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <span id="success-text"></span>
    </div>
    <div id="error-message" class="alert alert-danger" style="display: none; position: fixed; top: 20px; right: 20px; z-index: 9999;">
        <button type="button" class="close" data-dismiss="alert">&times;</button>
        <span></span>
    </div>
    
    <!-- 面包屑导航 -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">
                    <i class="fa fa-home"></i>
                    首页
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">
                    后台管理
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Users/list')}">
                    用户列表
                </a>
            </li>
            <li class="breadcrumb-item active">
                添加用户
            </li>
        </ol>
    </nav>
    
    <!-- 页面导航路径 -->
    <div class="page-navigation">
        <a href="{:U('Admin/Index/index')}" class="nav-item">
            <i class="fa fa-home"></i>
            首页
        </a>
        <div class="nav-separator">/</div>
        <a href="{:U('Admin/Index/index')}" class="nav-item">
            后台管理
        </a>
        <div class="nav-separator">/</div>
        <a href="{:U('Admin/Users/list')}" class="nav-item">
            用户列表
        </a>
        <div class="nav-separator">/</div>
        <div class="nav-item active">
            添加用户
        </div>
    </div>
    
    <div class="page-content">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-start">
                    <ul class="nav nav-tabs border-0">
                        <li class="nav-item">
                            <a class="nav-link" href="{:U('Users/list')}">用户列表</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="{:U('Users/add')}">添加用户</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
            <div class="tab-content">
                <!-- 桌面端表单 -->
                <div class="tab-pane active" id="add">
                    <form method="post" class="form-horizontal" role="form">
                        <div class="form-group">
                            <label class="col-sm-3 control-label no-padding-right" for="username">
                                <i class="fa fa-user"></i> QQ号码（用户名）
                            </label>
                            <div class="col-sm-9">
                                <input type="text" id="username" name="username" placeholder="请输入QQ号码作为用户名" 
                                       class="col-xs-10 col-sm-5" required>
                                <span class="help-inline col-xs-12 col-sm-7">
                                    <span class="middle">QQ号码将作为用户的登录用户名</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="col-sm-3 control-label no-padding-right" for="password">
                                <i class="fa fa-lock"></i> 登录密码
                            </label>
                            <div class="col-sm-9">
                                <input type="password" id="password" name="password" placeholder="请输入登录密码" 
                                       class="col-xs-10 col-sm-5" required>
                                <span class="help-inline col-xs-12 col-sm-7">
                                    <span class="middle">密码长度建议6位以上</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="col-sm-3 control-label no-padding-right">
                                <i class="fa fa-toggle-on"></i> 用户状态
                            </label>
                            <div class="col-sm-9">
                                <div class="radio">
                                    <label>
                                        <input name="status" type="radio" class="ace" value="1" checked>
                                        <span class="lbl">启用</span>
                                    </label>
                                </div>
                                <div class="radio">
                                    <label>
                                        <input name="status" type="radio" class="ace" value="0">
                                        <span class="lbl">禁用</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="col-sm-3 control-label no-padding-right" for="max_devices">
                                <i class="fa fa-mobile"></i> 最大设备数
                            </label>
                            <div class="col-sm-9">
                                <input type="number" id="max_devices" name="max_devices" placeholder="请输入最大设备数" 
                                       class="col-xs-10 col-sm-5" value="5" min="1" max="50" required>
                                <span class="help-inline col-xs-12 col-sm-7">
                                    <span class="middle">用户可同时使用的最大设备数量，默认为5个</span>
                                </span>
                            </div>
                        </div>
                        
                        <div class="clearfix form-actions">
                            <div class="col-md-offset-3 col-md-9">
                                <button class="btn btn-info" type="submit">
                                    <i class="icon-ok bigger-110"></i>
                                    添加用户
                                </button>
                                &nbsp; &nbsp; &nbsp;
                                <a href="{:U('Users/list')}" class="btn">
                                    <i class="icon-arrow-left bigger-110"></i>
                                    返回列表
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
                
            </div>
        </div>
        
        <!-- 桌面端帮助信息 -->
        <div class="col-xs-12">
            <div class="widget-box">
                <div class="widget-header widget-header-flat">
                    <h4 class="widget-title smaller">
                        <i class="fa fa-info-circle"></i> 添加说明
                    </h4>
                </div>
                <div class="widget-body">
                    <div class="widget-main">
                        <div class="row">
                            <div class="col-sm-6">
                                <h6><i class="fa fa-lightbulb-o"></i> 操作提示</h6>
                                <ul>
                                    <li>QQ号码将作为用户的唯一标识</li>
                                    <li>密码建议使用6位以上字符</li>
                                    <li>新用户默认为启用状态</li>
                                    <li>最大设备数默认为5个，可调整1-50个</li>
                                    <li>可以随时修改用户状态和设备限制</li>
                                </ul>
                            </div>
                            <div class="col-sm-6">
                                <h6><i class="fa fa-shield"></i> 安全建议</h6>
                                <ul>
                                    <li>使用强密码保护账户安全</li>
                                    <li>定期检查用户活动状态</li>
                                    <li>及时禁用异常账户</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 手机端帮助信息 -->
        <div class="mobile-help">
            <div class="mobile-help-title">
                <i class="fa fa-info-circle"></i> 添加说明
            </div>
            
            <div class="mobile-help-section">
                <div class="mobile-help-section-title">
                    <i class="fa fa-lightbulb-o"></i> 操作提示
                </div>
                <ul class="mobile-help-list">
                    <li>QQ号码将作为用户的唯一标识</li>
                    <li>密码建议使用6位以上字符</li>
                    <li>新用户默认为启用状态</li>
                    <li>最大设备数默认为5个，可调整1-50个</li>
                    <li>可以随时修改用户状态和设备限制</li>
                </ul>
            </div>
            
            <div class="mobile-help-section">
                <div class="mobile-help-section-title">
                    <i class="fa fa-shield"></i> 安全建议
                </div>
                <ul class="mobile-help-list">
                    <li>使用强密码保护账户安全</li>
                    <li>定期检查用户活动状态</li>
                    <li>及时禁用异常账户</li>
                </ul>
            </div>
        </div>
            </div>
        </div>
    </div>
</block>
<block name="js">
    <script>
    $(document).ready(function(){
        // 显示成功提示的函数
        function showSuccessMessage(message) {
            $('#success-text').text(message);
            $('#success-message').fadeIn().delay(3000).fadeOut();
        }
        
        // 表单提交（统一单表单，桌面/手机响应式）
        $('.form-horizontal').on('submit', function(e) {
            e.preventDefault();
            
            var formData = $(this).serialize();
            var submitBtn = $(this).find('button[type="submit"]');
            var originalText = submitBtn.length ? (submitBtn.html() || submitBtn.val() || '') : '';
            
            submitBtn.prop('disabled', true).html('添加中...');
            
            $.ajax({
                url: '{:U("Admin/Users/add")}',
                type: 'POST',
                data: formData,
                success: function(response) {
                    if (response && (response.code === 0 || response.status === 'success' || response.success === true || response.status === 1)) {
                        showSuccessMessage('添加成功！');
                        setTimeout(function() { window.location.href = '{:U("Admin/Users/list")}'; }, 1000);
                    } else {
                        var msg = (response && (response.msg || response.message)) || '添加失败，请重试';
                        $('#error-message').find('span').text(msg).end().show();
                        submitBtn.prop('disabled', false).html(originalText);
                    }
                },
                error: function(xhr) {
                    var msg = '网络错误或添加失败，请重试';
                    if (xhr.responseJSON && (xhr.responseJSON.msg || xhr.responseJSON.message))
                        msg = xhr.responseJSON.msg || xhr.responseJSON.message;
                    $('#error-message').find('span').text(msg).end().show();
                    submitBtn.prop('disabled', false).html(originalText);
                },
                complete: function() {
                    if (submitBtn.prop('disabled')) submitBtn.prop('disabled', false).html(originalText);
                }
            });
        });
    });
    </script>
</block>