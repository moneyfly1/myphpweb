<extend name="Public:base" />
<block name="title">ç»¼åˆä»ªè¡¨ç›˜</block>
<block name="content">
    <style>
        .dashboard { padding: 20px; }
        .dash-row { display: grid; gap: 20px; margin-bottom: 24px; }
        .dash-row-4 { grid-template-columns: repeat(4, 1fr); }
        .dash-row-2 { grid-template-columns: 1fr 1fr; }

        /* Top stat cards */
        .stat-card-lg {
            background: #fff; border-radius: 14px; padding: 24px;
            box-shadow: 0 2px 12px rgba(0,0,0,.06); display: flex;
            align-items: center; gap: 18px; transition: all .25s;
            border-left: 4px solid transparent; position: relative; overflow: hidden;
        }
        .stat-card-lg:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,.1); }
        .stat-card-lg .sc-icon {
            width: 56px; height: 56px; border-radius: 14px; display: flex;
            align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0;
        }
        .stat-card-lg .sc-info { flex: 1; }
        .stat-card-lg .sc-label { font-size: 13px; color: #8c8c8c; margin-bottom: 4px; }
        .stat-card-lg .sc-value { font-size: 28px; font-weight: 700; color: #1a1a2e; line-height: 1.2; }

        .sc-blue { border-left-color: #1677ff; }
        .sc-blue .sc-icon { background: rgba(22,119,255,.1); color: #1677ff; }
        .sc-green { border-left-color: #52c41a; }
        .sc-green .sc-icon { background: rgba(82,196,26,.1); color: #52c41a; }
        .sc-orange { border-left-color: #fa8c16; }
        .sc-orange .sc-icon { background: rgba(250,140,22,.1); color: #fa8c16; }
        .sc-red { border-left-color: #f5222d; }
        .sc-red .sc-icon { background: rgba(245,34,45,.1); color: #f5222d; }

        /* Small stat cards */
        .stat-card-sm {
            background: #fff; border-radius: 12px; padding: 18px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,.05); text-align: center; transition: all .25s;
        }
        .stat-card-sm:hover { transform: translateY(-2px); box-shadow: 0 4px 14px rgba(0,0,0,.08); }
        .stat-card-sm .sm-label { font-size: 13px; color: #8c8c8c; margin-bottom: 6px; }
        .stat-card-sm .sm-value { font-size: 22px; font-weight: 700; color: #1a1a2e; }
        .stat-card-sm .sm-sub { font-size: 12px; color: #bbb; margin-top: 4px; }
        /* Panel / table styles */
        .dash-panel {
            background: #fff; border-radius: 14px; padding: 0;
            box-shadow: 0 2px 12px rgba(0,0,0,.06); overflow: hidden;
        }
        .dash-panel-head {
            padding: 16px 22px; font-size: 15px; font-weight: 600; color: #1a1a2e;
            border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 8px;
        }
        .dash-panel-head .icon { font-size: 18px; }
        .dash-table { width: 100%; border-collapse: collapse; }
        .dash-table th {
            padding: 10px 16px; text-align: left; font-size: 12px; font-weight: 600;
            color: #8c8c8c; text-transform: uppercase; letter-spacing: .3px;
            background: #fafafa; border-bottom: 1px solid #f0f0f0;
        }
        .dash-table td {
            padding: 12px 16px; font-size: 13px; color: #444;
            border-bottom: 1px solid #f5f5f5;
        }
        .dash-table tr:last-child td { border-bottom: none; }
        .dash-table tr:hover td { background: #fafbff; }
        .dash-table .amount { color: #52c41a; font-weight: 600; }
        .dash-table .mono { font-family: 'SF Mono', Monaco, monospace; font-size: 12px; color: #999; }

        .status-badge {
            display: inline-block; padding: 2px 10px; border-radius: 9999px;
            font-size: 11px; font-weight: 500;
        }
        .badge-paid { background: rgba(82,196,26,.1); color: #52c41a; }
        .badge-unpaid { background: rgba(250,140,22,.1); color: #fa8c16; }
        .badge-failed { background: rgba(245,34,45,.1); color: #f5222d; }
        .badge-open { background: rgba(22,119,255,.1); color: #1677ff; }
        .badge-closed { background: rgba(140,140,140,.1); color: #8c8c8c; }

        /* System info */
        .sys-info-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 14px; padding: 18px 22px;
        }
        .sys-info-item .si-label { font-size: 12px; color: #8c8c8c; margin-bottom: 2px; }
        .sys-info-item .si-value { font-size: 14px; font-weight: 600; color: #333; }

        /* Responsive */
        @media (max-width: 1024px) {
            .dash-row-4 { grid-template-columns: repeat(2, 1fr); }
            .dash-row-2 { grid-template-columns: 1fr; }
            .sys-info-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 640px) {
            .dash-row-4 { grid-template-columns: 1fr; }
            .sys-info-grid { grid-template-columns: 1fr; }
            .stat-card-lg .sc-value { font-size: 22px; }
        }
    </style>

    <div class="dashboard">
        <!-- Row 1: Top stat cards -->
        <div class="dash-row dash-row-4">
            <div class="stat-card-lg sc-blue">
                <div class="sc-icon">ğŸ‘¥</div>
                <div class="sc-info">
                    <div class="sc-label">ç”¨æˆ·æ€»æ•°</div>
                    <div class="sc-value">{$totalUsers}</div>
                </div>
            </div>
            <div class="stat-card-lg sc-green">
                <div class="sc-icon">ğŸ“‹</div>
                <div class="sc-info">
                    <div class="sc-label">æ´»è·ƒè®¢é˜…</div>
                    <div class="sc-value">{$activeSubs}</div>
                </div>
            </div>
            <div class="stat-card-lg sc-orange">
                <div class="sc-icon">ğŸ’°</div>
                <div class="sc-info">
                    <div class="sc-label">æœ¬æœˆæ”¶å…¥</div>
                    <div class="sc-value">Â¥{$monthRevenue}</div>
                </div>
            </div>
            <div class="stat-card-lg sc-red">
                <div class="sc-icon">ğŸ«</div>
                <div class="sc-info">
                    <div class="sc-label">å¾…å¤„ç†å·¥å•</div>
                    <div class="sc-value">{$pendingTickets}</div>
                </div>
            </div>
        </div>

        <!-- Row 2: Secondary stats -->
        <div class="dash-row dash-row-4">
            <div class="stat-card-sm">
                <div class="sm-label">ä»Šæ—¥è®¢å•</div>
                <div class="sm-value">{$todayOrders}</div>
                <div class="sm-sub">æ€»è®¢å• {$totalOrders}</div>
            </div>
            <div class="stat-card-sm">
                <div class="sm-label">å³å°†åˆ°æœŸ (7å¤©)</div>
                <div class="sm-value" style="color:#fa8c16;">{$expiringSoon}</div>
                <div class="sm-sub">æ€»è®¢é˜… {$totalSubs}</div>
            </div>
            <div class="stat-card-sm">
                <div class="sm-label">24hæ´»è·ƒè®¾å¤‡</div>
                <div class="sm-value">{$activeDevices24h}</div>
                <div class="sm-sub">æ€»è®¾å¤‡ {$totalDevices}</div>
            </div>
            <div class="stat-card-sm">
                <div class="sm-label">èŠ‚ç‚¹åœ¨çº¿</div>
                <div class="sm-value" style="color:#52c41a;">{$onlineNodes}<span style="font-size:14px;color:#bbb;">/{$totalNodes}</span></div>
                <div class="sm-sub">å¾…å‘é‚®ä»¶ {$pendingEmails}</div>
            </div>
        </div>
        <!-- Row 3: Two-column tables -->
        <div class="dash-row dash-row-2">
            <!-- Recent Orders -->
            <div class="dash-panel">
                <div class="dash-panel-head"><span class="icon">ğŸ›’</span> æœ€è¿‘è®¢å•</div>
                <table class="dash-table">
                    <thead>
                        <tr>
                            <th>è®¢å•å·</th>
                            <th>ç”¨æˆ·</th>
                            <th>é‡‘é¢</th>
                            <th>çŠ¶æ€</th>
                            <th>æ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody>
                        <volist name="recentOrders" id="order">
                        <tr>
                            <td class="mono">{$order.order_no|default='â€”'}</td>
                            <td>{$order.user_name|default='â€”'}</td>
                            <td class="amount">Â¥{$order.total_amount|default='0'}</td>
                            <td>
                                <if condition="$order['status'] eq 1">
                                    <span class="status-badge badge-paid">å·²æ”¯ä»˜</span>
                                <elseif condition="$order['status'] eq 0" />
                                    <span class="status-badge badge-unpaid">å¾…æ”¯ä»˜</span>
                                <else />
                                    <span class="status-badge badge-failed">å¤±è´¥</span>
                                </if>
                            </td>
                            <td class="mono">{$order.create_time|default='â€”'}</td>
                        </tr>
                        </volist>
                        <notempty name="recentOrders" value="">
                        <empty name="recentOrders">
                        <tr><td colspan="5" style="text-align:center;color:#ccc;padding:30px;">æš‚æ— è®¢å•æ•°æ®</td></tr>
                        </empty>
                        </notempty>
                    </tbody>
                </table>
            </div>

            <!-- Recent Tickets -->
            <div class="dash-panel">
                <div class="dash-panel-head"><span class="icon">ğŸ«</span> æœ€è¿‘å·¥å•</div>
                <table class="dash-table">
                    <thead>
                        <tr>
                            <th>å·¥å•å·</th>
                            <th>ç”¨æˆ·</th>
                            <th>æ ‡é¢˜</th>
                            <th>çŠ¶æ€</th>
                            <th>æ—¶é—´</th>
                        </tr>
                    </thead>
                    <tbody>
                        <volist name="recentTickets" id="ticket">
                        <tr>
                            <td class="mono">{$ticket.ticket_no|default='â€”'}</td>
                            <td>{$ticket.username|default='â€”'}</td>
                            <td>{$ticket.title|mb_substr=0,20,'UTF-8'}</td>
                            <td>
                                <if condition="$ticket['status'] eq 0 OR $ticket['status'] eq 1">
                                    <span class="status-badge badge-open">å¤„ç†ä¸­</span>
                                <else />
                                    <span class="status-badge badge-closed">å·²å…³é—­</span>
                                </if>
                            </td>
                            <td class="mono">{$ticket.created_at|date='m-d H:i',###}</td>
                        </tr>
                        </volist>
                        <empty name="recentTickets">
                        <tr><td colspan="5" style="text-align:center;color:#ccc;padding:30px;">æš‚æ— å·¥å•æ•°æ®</td></tr>
                        </empty>
                    </tbody>
                </table>
            </div>
        </div>
        <!-- Row 4: System Info -->
        <div class="dash-panel" style="margin-top:4px;">
            <div class="dash-panel-head"><span class="icon">âš™ï¸</span> ç³»ç»Ÿä¿¡æ¯</div>
            <div class="sys-info-grid">
                <div class="sys-info-item">
                    <div class="si-label">PHP ç‰ˆæœ¬</div>
                    <div class="si-value">{$systemInfo.php_version}</div>
                </div>
                <div class="sys-info-item">
                    <div class="si-label">MySQL ç‰ˆæœ¬</div>
                    <div class="si-value">{$systemInfo.mysql_version}</div>
                </div>
                <div class="sys-info-item">
                    <div class="si-label">æœåŠ¡å™¨ç³»ç»Ÿ</div>
                    <div class="si-value">{$systemInfo.server_os}</div>
                </div>
                <div class="sys-info-item">
                    <div class="si-label">ç£ç›˜å¯ç”¨</div>
                    <div class="si-value">{$systemInfo.disk_free} / {$systemInfo.disk_total}</div>
                </div>
                <div class="sys-info-item">
                    <div class="si-label">æœåŠ¡å™¨æ—¶é—´</div>
                    <div class="si-value"><span id="server-time">{$systemInfo.server_time}</span></div>
                </div>
                <div class="sys-info-item">
                    <div class="si-label">æ•°æ®åˆ·æ–°</div>
                    <div class="si-value" style="font-size:12px;color:#999;">æ¯5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°</div>
                </div>
            </div>
        </div>
    </div>

    <script>
    (function(){
        function tick(){
            var d=new Date(),s=d.getFullYear()+'-'+
                String(d.getMonth()+1).padStart(2,'0')+'-'+
                String(d.getDate()).padStart(2,'0')+' '+
                String(d.getHours()).padStart(2,'0')+':'+
                String(d.getMinutes()).padStart(2,'0')+':'+
                String(d.getSeconds()).padStart(2,'0');
            var el=document.getElementById('server-time');
            if(el) el.textContent=s;
        }
        setInterval(tick,1000);
        tick();
        setInterval(function(){location.reload();},300000);
    })();
    </script>
</block>

<block name="js">
</block>
