<extend name="Public:base" />
<block name="title">套餐列表</block>
<block name="content">
    <nav class="breadcrumb">
        <a href="{:U('Admin/Index/index')}">首页</a>
        <span class="separator">/</span>
        <a href="{:U('Admin/Index/index')}">后台管理</a>
        <span class="separator">/</span>
        <span class="current">套餐列表</span>
    </nav>

    <div class="page-content">
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="{:U('Admin/Level/index')}">套餐列表</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{:U('Admin/Level/add')}">添加套餐</a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <!-- 桌面端表格 -->
                <div class="desktop-table">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th width="8%">id</th>
                                <th>名称</th>
                                <th>天数</th>
                                <th>金额</th>
                                <th>最大设备数</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <foreach name="list" item="v">
                            <tr>
                                <td>{$v['id']}</td>
                                <td>{$v['name']}</td>
                                <td>{$v['num']}</td>
                                <td>{$v['price']}</td>
                                <td>{$v['setdrivers']|default=5}</td>
                                <td>
                                    <if condition="$v['status'] eq 1">
                                        <span class="status-badge status-active">启用</span>
                                    <else />
                                        <span class="status-badge status-disabled">禁用</span>
                                    </if>
                                </td>
                                <td>
                                    <div class="action-group">
                                        <a class="btn btn-xs btn-warning" href="{:U('Admin/Level/edit',array('id'=>$v['id']))}">编辑</a>
                                        <a class="btn btn-xs btn-danger" onClick="return confirm('确定删除?');" href="{:U('Admin/Level/del',array('id'=>$v['id']))}">删除</a>
                                        <if condition="$v['status'] eq 1">
                                            <a class="btn btn-xs btn-default" href="{:U('Admin/Level/disable',array('id'=>$v['id']))}">禁用</a>
                                        <else />
                                            <a class="btn btn-xs btn-success" href="{:U('Admin/Level/enable',array('id'=>$v['id']))}">启用</a>
                                        </if>
                                    </div>
                                </td>
                            </tr>
                            </foreach>
                        </tbody>
                    </table>
                </div>

                <!-- 移动端卡片 -->
                <div class="mobile-card-list">
                    <foreach name="list" item="v">
                    <div class="mobile-card">
                        <div class="card-header-row">
                            <div class="card-title">{$v['name']}</div>
                            <if condition="$v['status'] eq 1">
                                <span class="status-badge status-active">启用</span>
                            <else />
                                <span class="status-badge status-disabled">禁用</span>
                            </if>
                        </div>
                        <div class="card-row">
                            <span class="label">天数</span>
                            <span class="value">{$v['num']}</span>
                        </div>
                        <div class="card-row">
                            <span class="label">金额</span>
                            <span class="value">{$v['price']}</span>
                        </div>
                        <div class="card-row">
                            <span class="label">最大设备数</span>
                            <span class="value">{$v['setdrivers']|default=5}</span>
                        </div>
                        <div class="card-actions">
                            <a class="btn btn-xs btn-warning" href="{:U('Admin/Level/edit',array('id'=>$v['id']))}">编辑</a>
                            <a class="btn btn-xs btn-danger" onClick="return confirm('确定删除?');" href="{:U('Admin/Level/del',array('id'=>$v['id']))}">删除</a>
                            <if condition="$v['status'] eq 1">
                                <a class="btn btn-xs btn-default" href="{:U('Admin/Level/disable',array('id'=>$v['id']))}">禁用</a>
                            <else />
                                <a class="btn btn-xs btn-success" href="{:U('Admin/Level/enable',array('id'=>$v['id']))}">启用</a>
                            </if>
                        </div>
                    </div>
                    </foreach>
                </div>

            </div>
            <div class="page-footer">
                <div class="pagination-info">共 {$totalCount} 条记录</div>
                <div class="pagination-container">
                    <div class="pagination">{$page}</div>
                    <div class="pagination-jump">
                        <span>跳转到</span>
                        <input type="number" id="jumpPage" min="1" placeholder="页码">
                        <button id="jumpButton" class="btn btn-primary">确定</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="__PUBLIC__/statics/js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
    $(function () {
        $('.alls').change(function(){
            var check = $(this).prop('checked');
            $('.all').prop('checked',check);
        })

        //删除
        $('#allDel').click(function () {
            var chk_value = [];
            $('input[name="all"]:checked').each(function(){
                chk_value.push($(this).val());
            })
            $.ajax({
                url: "{:U('Admin/Level/allDel')}",
                type:'post',
                data:{id:chk_value.join(',')},
                success:function(e){
                    if(e=='删除成功'){
                        location.reload();
                    }else{
                        alert(e+'!请稍后再试');
                    }
                }
            })
        })

        //发邮件
        $('#allPush').click(function () {
            var chk_value = [];
            $('input[name="all"]:checked').each(function(){
                chk_value.push($(this).val());
            })
            $.ajax({
                url: "{:U('Admin/Level/allPush')}",
                type:'post',
                data:{id:chk_value.join(',')},
                success:function(e){
                    if(e=='发送成功'){
                        alert('已全部发送，如出现未成功请重试')
                        location.reload();
                    }else{
                        alert(e+'!请稍后再试');
                    }
                }
            })
        })

        //禁用
        $('#allDisable').click(function () {
            var chk_value = [];
            $('input[name="all"]:checked').each(function(){
                chk_value.push($(this).val());
            })
            $.ajax({
                url: "{:U('Admin/Level/allDisable')}",
                type:'post',
                data:{id:chk_value.join(',')},
                success:function(e){
                    if(e=='禁用成功'){
                        alert('已全部禁用，如出现个别未成功请单独重试')
                        location.reload();
                    }else{
                        alert(e+'!请稍后再试');
                    }
                }
            })
        })

        //启用
        $('#allEnable').click(function () {
            var chk_value = [];
            $('input[name="all"]:checked').each(function(){
                chk_value.push($(this).val());
            })
            $.ajax({
                url: "{:U('Admin/Level/allEnable')}",
                type:'post',
                data:{id:chk_value.join(',')},
                success:function(e){
                    if(e=='启用成功'){
                        alert('已全部启用，如出现个别未成功请单独重试')
                        location.reload();
                    }else{
                        alert(e+'!请稍后再试');
                    }
                }
            })
        })

        // 页码跳转功能
        $('#jumpButton').click(function () {
            var page = $('#jumpPage').val();
            if (page) {
                var url = new URL(window.location.href);
                url.searchParams.set('p', page);
                window.location.href = url.toString();
            }
        });

        $('.endtime').blur(function (){
            var id = $(this).attr('data');
            var vals = $(this).val();
            $.ajax({
                url: "{:U('Admin/Level/editTime')}",
                type:'post',
                data:{id:id,endtime:vals},
                success:function(e){
                }
            })
        });

    })
    </script>
</block>