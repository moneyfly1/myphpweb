<extend name="Public:base" />
<block name="title">添加订阅</block>
<block name="content">
    <!-- 引入layer.js库 -->
    <script src="__PUBLIC__/statics/layer/layer.js"></script>

    <!-- 面包屑导航 -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">
                    <i class="fa fa-home"></i>
                    首页
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">
                    后台管理
                </a>
            </li>
            <li class="breadcrumb-item active">
                添加订阅
            </li>
        </ol>
    </nav>
    
    <!-- 页面导航路径 -->
    <div class="page-navigation">
        <a href="{:U('Admin/Index/index')}" class="nav-item">
            <i class="fa fa-home"></i>
            首页
        </a>
        <div class="nav-separator">/</div>
        <a href="{:U('Admin/Index/index')}" class="nav-item">
            后台管理
        </a>
        <div class="nav-separator">/</div>
        <div class="nav-item active">
            订阅管理
        </div>
        <div class="nav-separator">/</div>
        <div class="nav-item active">
            添加订阅
        </div>
    </div>
    
    <div class="page-content">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-start">
                    <ul class="nav nav-tabs border-0">
                        <li class="nav-item">
                            <a class="nav-link" href="{:U('Admin/Dingyue/list')}">订阅列表</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="{:U('Admin/Dingyue/add')}">添加订阅</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <style>
                    /* 表单样式 */
                    .form-group {
                        margin-bottom: 20px;
                    }
                    
                    .form-label {
                        display: block;
                        font-size: 14px;
                        font-weight: 500;
                        color: #333;
                        margin-bottom: 8px;
                    }
                    
                    .form-control {
                        width: 100%;
                        padding: 10px 12px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        font-size: 14px;
                        transition: border-color 0.3s ease;
                    }
                    
                    .form-control:focus {
                        outline: none;
                        border-color: #007bff;
                        box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
                    }
                    
                    .form-text {
                        font-size: 12px;
                        color: #666;
                        margin-top: 4px;
                    }
                    
                            /* 快速设备数量按钮样式 */
                    .quick-device-section {
                        margin-top: 10px;
                    }
                    
                    .quick-device-buttons {
                        display: flex;
                        gap: 8px;
                        margin-top: 8px;
                    }
                    
                    .quick-device-btn {
                        padding: 6px 12px;
                        font-size: 12px;
                        border: 1px solid #28a745;
                        background: #fff;
                        color: #28a745;
                        border-radius: 4px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                    }
                    
                    .quick-device-btn:hover {
                        background: #28a745;
                        color: #fff;
                    }
                    
                    /* 按钮样式 */
                    .btn-submit {
                        background: #007bff;
                        color: #fff;
                        border: none;
                        padding: 12px 24px;
                        font-size: 14px;
                        border-radius: 4px;
                        cursor: pointer;
                        transition: background-color 0.3s ease;
                        margin-right: 10px;
                    }
                    
                    .btn-submit:hover {
                        background: #0056b3;
                    }
                    
                    .btn-secondary {
                        background: #6c757d;
                        color: #fff;
                        border: none;
                        padding: 12px 24px;
                        font-size: 14px;
                        border-radius: 4px;
                        cursor: pointer;
                        transition: background-color 0.3s ease;
                        text-decoration: none;
                        display: inline-block;
                    }
                    
                    .btn-secondary:hover {
                        background: #545b62;
                        color: #fff;
                        text-decoration: none;
                    }
                    
                    /* 消息样式 */
                    .success-message {
                        background: rgba(40, 167, 69, 0.1);
                        color: #28a745;
                        border: 1px solid rgba(40, 167, 69, 0.2);
                        border-radius: 4px;
                        padding: 12px;
                        margin-bottom: 20px;
                        display: none;
                    }
                    
                    .error-message {
                        background: rgba(220, 53, 69, 0.1);
                        color: #dc3545;
                        border: 1px solid rgba(220, 53, 69, 0.2);
                        border-radius: 4px;
                        padding: 12px;
                        margin-bottom: 20px;
                        display: none;
                    }
                    
                    /* 加载动画 */
                    .loading {
                        display: inline-block;
                        width: 16px;
                        height: 16px;
                        border: 2px solid #ced4da;
                        border-radius: 50%;
                        border-top-color: #007bff;
                        animation: spin 1s ease-in-out infinite;
                    }
                    
                    @keyframes spin {
                        to { transform: rotate(360deg); }
                    }
                    
                    /* 响应式设计 */
                    @media (max-width: 768px) {
                        .quick-date-buttons,
                        .quick-device-buttons {
                            flex-wrap: wrap;
                        }
                        
                        .quick-date-btn,
                        .quick-device-btn {
                            flex: 1;
                            min-width: 80px;
                        }
                        
                        .btn-submit,
                        .btn-secondary {
                            width: 100%;
                            margin-bottom: 10px;
                            margin-right: 0;
                        }
                    }
                </style>

                <!-- 成功/错误消息 -->
                <div id="success-message" class="success-message"></div>
                <div id="error-message" class="error-message"></div>

                <form method="post" action="{:U('Admin/Dingyue/add')}">
                    <div class="form-group">
                        <label for="qq" class="form-label">QQ号码 <span style="color: #dc3545;">*</span></label>
                        <input type="text" id="qq" name="qq" class="form-control" required>
                        <div class="form-text">请输入用户的QQ号码</div>
                    </div>

                    <div class="form-group">
                        <label for="endtime" class="form-label">到期时间 <span style="color: #dc3545;">*</span></label>
                        <input type="date" id="endtime" name="endtime" class="form-control" required>
                        <div class="form-text">设置订阅的到期时间</div>
                    </div>


                    <div class="form-group">
                        <label for="status" class="form-label">状态</label>
                        <select id="status" name="status" class="form-control">
                            <option value="1">正常</option>
                            <option value="0">已过期</option>
                            <option value="2">已禁用</option>
                        </select>
                        <div class="form-text">设置订阅的初始状态</div>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="btn-submit" id="submit-btn">
                            创建订阅
                        </button>
                        <a href="{:U('Admin/Dingyue/list')}" class="btn-secondary">
                            返回列表
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            // 快速设置设备数量功能
            $('.quick-device-btn').click(function() {
                var devices = parseInt($(this).attr('data-devices'));
                var currentValue = parseInt($('#max_devices').val()) || 0;
                $('#max_devices').val(currentValue + devices);
                
                // 显示提示信息
                if(window.layer){
                    layer.msg('已增加' + devices + '个设备数量');
                }
            });
            
            // 表单提交处理
            $('form').submit(function(e) {
                e.preventDefault();
                
                var submitBtn = $('#submit-btn');
                var originalText = submitBtn.html();
                
                // 显示加载状态
                submitBtn.html('<span class="loading"></span> 创建中...');
                submitBtn.prop('disabled', true);
                
                // 隐藏之前的消息
                $('#success-message, #error-message').hide();
                
                $.post($(this).attr('action'), $(this).serialize(), function(data) {
                    if (data.code == 1) {
                        // 显示成功消息
                        $('#success-message').html('订阅创建成功！正在跳转...').show();
                        
                        // 延迟跳转
                        setTimeout(function() {
                            window.location.href = '{:U("Admin/Dingyue/list")}';
                        }, 1500);
                    } else {
                        // 显示错误消息
                        $('#error-message').text('创建失败：' + (data.msg || '')).show();
                        
                        // 恢复按钮状态
                        submitBtn.html(originalText);
                        submitBtn.prop('disabled', false);
                    }
                }).fail(function() {
                    // 网络错误
                    $('#error-message').text('网络错误，请重试').show();
                    
                    // 恢复按钮状态
                    submitBtn.html(originalText);
                    submitBtn.prop('disabled', false);
                });
            });
        });
    </script>
</block>