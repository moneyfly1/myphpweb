<extend name="Public:base" />
<block name="title">è®¢é˜…åˆ—è¡¨</block>
<block name="content">
    <style>
        /* ===== é¡µé¢ç‰¹æœ‰æ ·å¼ (Dingyue/list) ===== */

        /* è¡¨æ ¼å¸ƒå±€ */
        .table { table-layout: fixed; width: 100%; min-width: 100%; text-align: left; font-size: 15px; }
        .table th { text-align: center !important; white-space: nowrap; }
        .table th span, .table th div { text-align: center !important; }
        .table td { text-align: center; line-height: 1.5; font-size: 15px; }
        .table td:nth-child(2), .table td:nth-child(5), .table td:nth-child(6), .table td:nth-child(7), .table td:nth-child(8) {
            text-align: left; white-space: normal; word-break: break-all;
        }

        /* è¡¨æ ¼åˆ—å®½ */
        .table th:nth-child(1), .table td:nth-child(1) { width: 60px; }
        .table th:nth-child(2), .table td:nth-child(2) { width: 100px; }
        .table th:nth-child(3), .table td:nth-child(3) { width: 140px; }
        .table th:nth-child(4), .table td:nth-child(4) { width: 70px; }
        .table th:nth-child(5), .table td:nth-child(5) { width: 150px; }
        .table th:nth-child(6), .table td:nth-child(6) { width: 150px; }
        .table th:nth-child(7), .table td:nth-child(7) { width: 80px; }
        .table th:nth-child(8), .table td:nth-child(8) { width: 80px; }
        .table th:nth-child(9), .table td:nth-child(9) { width: 60px; }
        .table th:nth-child(10), .table td:nth-child(10) { width: 60px; }
        .table th:nth-child(11), .table td:nth-child(11) { width: 60px; }
        .table th:nth-child(12), .table td:nth-child(12) { width: 120px; }
        .table th:nth-child(13), .table td:nth-child(13) { width: auto; min-width: 160px; }

        /* æ“ä½œåˆ—gridå¸ƒå±€ */
        .table td:nth-child(13) {
            text-align: right; white-space: normal; padding: 6px 8px;
            width: 200px !important; max-width: 200px !important; min-width: 200px !important;
            display: grid !important; grid-template-columns: repeat(3, 60px) !important;
            grid-template-rows: repeat(2, auto) !important; gap: 4px !important; justify-content: end !important;
        }
        .table td:nth-child(13) .btn {
            display: block !important; margin: 0 !important;
            width: 60px !important; min-width: 60px !important; max-width: 60px !important;
            font-size: 13px; padding: 5px 4px; text-align: center;
        }

        /* btn-xs */
        .btn-xs { font-size: 13px; padding: 6px 8px; margin: 2px; border-radius: 4px; font-weight: 500; min-width: 50px; }

        /* è¡¨å•è¾“å…¥ - endtime / setdrivers */
        .endtime, .setdrivers-input {
            max-width: 120px; font-size: 14px; padding: 8px 10px;
            border: 1px solid var(--border-color); border-radius: var(--radius); background: #fff; transition: var(--transition);
        }
        .setdrivers-input { width: 80px !important; max-width: 80px !important; }
        .endtime { width: 175px !important; max-width: 175px !important; }
        .endtime:focus, .setdrivers-input:focus {
            border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(22, 119, 255, 0.2); outline: none;
        }

        /* å¿«é€ŸæŒ‰é’® */
        .quick-date-buttons, .quick-device-buttons { display: flex; gap: 4px; margin-top: 4px; flex-wrap: nowrap; align-items: center; }
        .quick-date-btn, .quick-device-btn {
            font-size: 13px; padding: 4px 10px; border: 1px solid var(--border-color);
            background: var(--light-bg); color: var(--text-secondary); border-radius: 4px;
            cursor: pointer; transition: var(--transition); font-weight: 500; width: 55px; text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .quick-date-btn:hover, .quick-device-btn:hover { background: #e9ecef; border-color: #adb5bd; transform: translateY(-1px); }

        /* äºŒç»´ç  */
        .show-qrcode-btn {
            max-width: 55px !important; max-height: 55px !important; width: auto; height: auto;
            border-radius: 4px; border: 1px solid var(--border-color); transition: var(--transition); cursor: pointer;
        }
        .show-qrcode-btn:hover { border-color: var(--primary-color); transform: scale(1.05); box-shadow: var(--shadow-hover); }
        .qrcode-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.7); z-index: 1000; justify-content: center; align-items: center;
        }
        .qrcode-modal img {
            max-width: 90%; max-height: 90vh; object-fit: contain;
            background-color: white; padding: 10px; border-radius: var(--radius);
        }

        /* å¤åˆ¶é“¾æ¥ */
        .copy-link { cursor: pointer; color: var(--primary-color); text-decoration: underline; word-break: break-all; }
        .copy-link:active { color: var(--primary-hover); }

        /* æ’åº */
        .sortable-header {
            position: relative; cursor: pointer; user-select: none; transition: var(--transition);
            display: flex; align-items: center; justify-content: center;
            padding: 8px 12px; border-radius: var(--radius); background: transparent; text-align: center;
        }
        .sortable-header span { text-align: center; flex: 1; }
        .sortable-header:hover { background: var(--primary-light); color: var(--primary-color); }
        .sortable-header.active { background: var(--primary-light); color: var(--primary-color); font-weight: 600; }
        .sort-arrow { margin-left: 4px; font-size: 14px; color: var(--text-muted); transition: var(--transition); display: flex; align-items: center; gap: 2px; }
        .sortable-header:hover .sort-arrow, .sortable-header.active .sort-arrow { color: var(--primary-color); }
        .sort-arrow .fa-sort { opacity: 0.5; }
        .sort-arrow .fa-sort-up, .sort-arrow .fa-sort-down { opacity: 1; font-weight: bold; }
        .sort-arrow .fa-sort-up { color: var(--success-color); }
        .sort-arrow .fa-sort-down { color: var(--danger-color); }
        .sort-indicator { display: inline-flex; align-items: center; gap: 4px; font-size: 13px; color: var(--text-muted); margin-left: 4px; }
        .sort-indicator.active { color: var(--primary-color); font-weight: 500; }

        /* æœç´¢è¡¨å• */
        .search-form { display: flex; align-items: center; flex: 1; margin-right: 15px; flex-wrap: nowrap; }
        .search-form input[type="text"] { margin-right: 10px; width: 250px; flex-shrink: 0; }
        .search-form .btn { font-size: 16px; padding: 8px 16px; height: 40px; margin-right: 10px; white-space: nowrap; }

        /* æ’åºçŠ¶æ€æ  */
        .sort-status-bar {
            background: var(--primary-light); border: 1px solid #d6e4ff; border-radius: var(--radius);
            padding: 10px 14px; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; font-size: 15px;
        }
        .sort-status-bar i { color: var(--primary-color); }
        .sort-status-bar a { margin-left: auto; color: var(--text-muted); text-decoration: none; font-size: 14px; }
        .sort-status-bar a:hover { color: var(--primary-color); text-decoration: underline; }

        /* åˆ—è®¾ç½®æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;
        }
        .modal-content {
            background: white; border-radius: var(--radius-lg); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; position: relative;
        }
        .modal-header {
            padding: 20px; border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-header h3 { margin: 0; color: var(--text-primary); }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #666; }
        .close-btn:hover { color: var(--text-primary); }
        .modal-body { padding: 20px; }
        .column-settings { margin-bottom: 20px; }
        .setting-item { display: flex; align-items: center; margin-bottom: 15px; gap: 10px; }
        .setting-item label { min-width: 100px; font-weight: 500; color: var(--text-primary); }
        .setting-item input[type="range"] { flex: 1; height: 6px; border-radius: 3px; background: #ddd; outline: none; -webkit-appearance: none; margin: 0 10px; }
        .setting-item input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: var(--primary-color); cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .setting-item input[type="range"]::-moz-range-thumb { width: 18px; height: 18px; border-radius: 50%; background: var(--primary-color); cursor: pointer; border: none; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .setting-item input[type="range"]::-webkit-slider-track { background: #e0e0e0; border-radius: 3px; height: 6px; }
        .setting-item input[type="range"]::-moz-range-track { background: #e0e0e0; border-radius: 3px; height: 6px; border: none; }
        .setting-item span { min-width: 50px; text-align: right; font-weight: 500; color: var(--primary-color); }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; }

        /* æ‰‹æœºç«¯å¡ç‰‡ç‰¹æœ‰æ ·å¼ */
        .mobile-card-header {
            display: flex; justify-content: space-between; align-items: center;
            margin: -16px -16px 16px -16px; padding: 12px 16px;
            border-bottom: 2px solid #e3f2fd; border-radius: 16px 16px 0 0;
            background: linear-gradient(90deg, rgba(22, 119, 255, 0.05), rgba(22, 119, 255, 0.02));
        }
        .mobile-card-qq {
            font-size: 18px; font-weight: 600; color: var(--primary-color);
            background: rgba(255, 255, 255, 0.8); padding: 4px 12px; border-radius: 20px;
            border: 1px solid rgba(22, 119, 255, 0.2);
        }
        .mobile-card-status { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .mobile-card-status.enabled { background: #d4edda; color: #155724; }
        .mobile-card-status.disabled { background: #f8d7da; color: #721c24; }
        .mobile-card-content { margin-bottom: 16px; }
        .mobile-card-row {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; font-size: 14px; min-height: 36px; padding: 8px 0;
            border-bottom: 1px solid rgba(22, 119, 255, 0.08);
        }
        .mobile-card-row:last-child { border-bottom: none; margin-bottom: 0; }
        .mobile-card-label { color: #555; font-weight: 500; flex: 1; font-size: 13px; }
        .mobile-card-value { color: var(--primary-color); text-align: right; flex: 1; font-weight: 500; font-size: 13px; }
        .mobile-card-value input {
            width: 100%; padding: 6px 10px; border: 1px solid #e3f2fd; border-radius: 8px;
            font-size: 13px; text-align: center; background: rgba(22, 119, 255, 0.02);
            color: var(--primary-color); font-weight: 500;
        }
        .mobile-card-value input:focus { outline: none; border-color: var(--primary-color); background: #fff; box-shadow: 0 0 0 2px rgba(22, 119, 255, 0.1); }
        .mobile-card-links {
            margin: 16px 0; background: linear-gradient(135deg, var(--light-bg), #e3f2fd);
            border-radius: 12px; padding: 12px; border: 1px solid rgba(22, 119, 255, 0.1);
        }
        .mobile-card-link {
            display: flex; align-items: center; background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(22, 119, 255, 0.15); border-radius: 10px; padding: 10px 12px;
            margin-bottom: 8px; font-size: 13px; word-break: break-all; color: var(--primary-color);
            text-decoration: none; transition: var(--transition); backdrop-filter: blur(5px); cursor: pointer;
        }
        .mobile-card-link:last-child { margin-bottom: 0; }
        .mobile-card-link:hover { background: #e3f2fd; transform: scale(0.98); }
        .mobile-card-link-icon { margin-right: 8px; font-size: 16px; }
        .mobile-card-link-text { flex: 1; font-size: 12px; color: #666; }
        .mobile-card-link-url { flex: 2; font-size: 12px; color: #42a5f5; }
        .mobile-card-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .mobile-card-actions .btn { font-size: 14px; padding: 12px 8px; margin: 0; border-radius: 8px; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .mobile-card-actions .btn i { font-size: 12px; }
        .mobile-card-checkbox { position: absolute; top: 10px; right: 10px; transform: scale(1.3); z-index: 10; }
        .mobile-card-qrcode { text-align: center; margin: 12px 0; }
        .mobile-card-qrcode-title { font-size: 13px; color: #666; margin-bottom: 6px; }
        .mobile-card-qrcode-img { max-width: 100px; max-height: 100px; border-radius: 8px; border: 1px solid #e3f2fd; }

        /* detail-btn */
        .detail-btn { font-size: 11px; padding: 2px 6px; }

        /* ===== å“åº”å¼ ===== */
        @media (max-width: 768px) {
            .desktop-table { display: none; }
            .mobile-card-list { display: block; }
            .search-form { flex-direction: column !important; gap: 10px !important; }
            .search-form input[type="text"] { width: 100% !important; min-width: auto !important; margin-right: 0 !important; }
            .search-form .btn { width: 100% !important; justify-content: center; height: 40px; font-size: 16px; }
            .batch-toolbar .batch-left { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px 0; }
            .batch-toolbar .batch-left .btn { font-size: 14px; padding: 12px 8px; margin: 0; border-radius: 8px; }
            .sortable-header { padding: 8px 10px; font-size: 14px; }
            .sort-arrow { margin-left: 4px; font-size: 12px; }
            .sort-indicator { font-size: 11px; margin-left: 2px; }
            .sort-indicator.active { display: none; }
            #column-settings-modal { width: 90% !important; max-width: 300px !important; border-radius: 8px !important; }
            .modal-header { padding: 15px; }
            .modal-body { padding: 15px; }
            .setting-item label { min-width: 80px; font-size: 14px; }
            .setting-item input[type="checkbox"] { transform: scale(1.2); margin-right: 10px; }
            .mobile-card-value input { background: var(--light-bg); border: 1px solid var(--border-color); transition: var(--transition); }
            .mobile-card-value input:focus { background: #fff; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(22, 165, 245, 0.2); outline: none; }
            .mobile-card-link { cursor: pointer; user-select: none; }
            .mobile-card-link:hover { background: #e3f2fd; }
            .quick-date-buttons { display: flex; gap: 3px; margin-top: 5px; flex-wrap: nowrap; align-items: center; }
            .quick-date-btn {
                padding: 3px 8px; font-size: 11px; border: 1px solid #28a745;
                background: linear-gradient(135deg, #d4edda, #c3e6cb); color: #155724;
                border-radius: 4px; cursor: pointer; transition: var(--transition); font-weight: 500; width: 30px; text-align: center;
                box-shadow: 0 1px 3px rgba(40, 167, 69, 0.2);
            }
            .quick-date-btn:hover { background: linear-gradient(135deg, #28a745, #20c997); color: #fff; transform: translateY(-1px); box-shadow: 0 3px 8px rgba(40, 167, 69, 0.4); border-color: #20c997; }
            .quick-device-buttons { display: flex; gap: 3px; margin-top: 5px; flex-wrap: nowrap; align-items: center; }
            .quick-device-btn {
                padding: 3px 8px; font-size: 11px; border: 1px solid var(--primary-color);
                background: linear-gradient(135deg, #cce7ff, #b3daff); color: #004085;
                border-radius: 4px; cursor: pointer; transition: var(--transition); font-weight: 500; width: 30px; text-align: center;
                box-shadow: 0 1px 3px rgba(22, 119, 255, 0.2);
            }
            .quick-device-btn:hover { background: linear-gradient(135deg, #1677ff, #40a9ff); color: #fff; transform: translateY(-1px); box-shadow: 0 3px 8px rgba(22, 119, 255, 0.4); border-color: #40a9ff; }
            .show-qrcode-btn { max-width: 80px !important; max-height: 80px !important; }
        }

        @media (min-width: 769px) {
            .mobile-card-list { display: none; }
            .endtime-date, .setdrivers-input { border: 2px solid var(--primary-color) !important; border-radius: 6px !important; padding: 8px 10px !important; font-size: 16px !important; background: var(--light-bg) !important; transition: var(--transition) !important; outline: none !important; }
            .endtime-date:focus, .setdrivers-input:focus { border-color: var(--primary-hover) !important; box-shadow: 0 0 0 3px rgba(0, 64, 133, 0.2) !important; background: #ffffff !important; }
            .search-form input[name="search"] { border: 3px solid var(--primary-color) !important; border-radius: 8px !important; padding: 12px 18px !important; font-size: 16px !important; background: var(--light-bg) !important; transition: var(--transition) !important; outline: none !important; width: 250px !important; box-shadow: 0 2px 8px rgba(0, 64, 133, 0.1) !important; }
            .search-form input[name="search"]:focus { border-color: var(--primary-hover) !important; box-shadow: 0 0 0 4px rgba(0, 64, 133, 0.2), 0 4px 12px rgba(0, 64, 133, 0.15) !important; background: #ffffff !important; transform: translateY(-1px) !important; }
        }

        /* ä¸­ç­‰å±å¹• */
        @media (max-width: 1200px) {
            .table th, .table td { padding: 8px 10px; font-size: 14px; }
            .table td:nth-child(13) .btn { font-size: 12px; padding: 4px 6px; width: 55px !important; min-width: 55px !important; max-width: 55px !important; margin: 0 !important; }
            .table td:nth-child(13) { display: grid !important; grid-template-columns: repeat(3, 55px) !important; grid-template-rows: repeat(2, auto) !important; gap: 3px !important; justify-content: end !important; width: 175px !important; max-width: 175px !important; min-width: 175px !important; }
            .table th:nth-child(1), .table td:nth-child(1) { width: 35px; }
            .table th:nth-child(2), .table td:nth-child(2) { width: 70px; }
            .table th:nth-child(3), .table td:nth-child(3) { width: 100px; }
            .table th:nth-child(4), .table td:nth-child(4) { width: 60px; }
            .table th:nth-child(5), .table td:nth-child(5) { width: 120px; }
            .table th:nth-child(6), .table td:nth-child(6) { width: 120px; }
            .table th:nth-child(7), .table td:nth-child(7) { width: 70px; }
            .table th:nth-child(8), .table td:nth-child(8) { width: 70px; }
            .table th:nth-child(9), .table td:nth-child(9) { width: 50px; }
            .table th:nth-child(10), .table td:nth-child(10) { width: 50px; }
            .table th:nth-child(11), .table td:nth-child(11) { width: 50px; }
            .table th:nth-child(12), .table td:nth-child(12) { width: 100px; }
            .table th:nth-child(13), .table td:nth-child(13) { width: 175px !important; min-width: 175px !important; }
        }

        /* è¶…å°å±å¹• */
        @media (max-width: 480px) {
            .sortable-header { padding: 4px 6px; font-size: 11px; }
            .sort-arrow { margin-left: 2px; font-size: 9px; }
            .detail-btn { font-size: 9px !important; padding: 1px 3px !important; }
            td { padding: 2px 1px !important; font-size: 11px; }
            .endtime { max-width: 60px !important; font-size: 10px !important; }
            .mobile-card { padding: 12px !important; border-radius: 12px !important; }
            .mobile-card-header { margin: -12px -12px 12px -12px !important; padding: 10px 12px !important; border-radius: 12px 12px 0 0 !important; }
            .mobile-card-qq { font-size: 16px !important; padding: 3px 10px !important; }
            .mobile-card-row { font-size: 13px !important; min-height: 32px !important; padding: 6px 0 !important; margin-bottom: 8px !important; }
            .mobile-card-label, .mobile-card-value { font-size: 12px !important; }
            .quick-date-btn, .quick-device-btn { padding: 4px 10px !important; font-size: 12px !important; min-width: 40px !important; border-radius: 6px !important; margin: 2px !important; }
            .quick-date-buttons, .quick-device-buttons { gap: 4px !important; justify-content: center !important; margin-top: 8px !important; }
            .show-qrcode-btn { max-width: 80px !important; max-height: 80px !important; }
        }
    </style>

    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <nav class="breadcrumb">
        <span class="breadcrumb-item">
            <a href="{:U('Admin/Index/index')}"><i class="fa fa-home"></i> é¦–é¡µ</a>
        </span>
        <span class="breadcrumb-item">
            <a href="{:U('Admin/Index/index')}">åå°ç®¡ç†</a>
        </span>
        <span class="breadcrumb-item active">è®¢é˜…åˆ—è¡¨</span>
    </nav>

    <div class="card">
        <div class="card-header">
            <div class="d-flex justify-content-start">
                <ul class="nav nav-tabs border-0">
                    <li class="nav-item">
                        <a class="nav-link active" href="{:U('Admin/Dingyue/list')}">è®¢é˜…åˆ—è¡¨</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{:U('Admin/Dingyue/add')}">æ·»åŠ è®¢é˜…</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="card-body">
            <!-- æœç´¢è¡¨å• -->
            <div class="row mb-2" style="margin-bottom: 15px !important;">
                <div class="col-md-12">
                    <div class="d-flex align-items-center justify-content-between">
                        <form method="post" class="search-form d-flex align-items-center" style="flex: 1; margin-right: 15px; flex-wrap: nowrap;">
                            <input type="text" class="form-control" name="search" placeholder="è¾“å…¥QQæˆ–ä»»æ„è®¢é˜…åœ°å€æŸ¥è¯¢" value="{$data[0]['search']}" style="margin-right: 10px; width: 250px; flex-shrink: 0;">
                            <button class="btn btn-primary btn-sm" type="submit">æœç´¢</button>
                            <button id="clean-all-drivers-btn" class="btn btn-danger btn-sm" type="button">æ¸…ç†è®¾å¤‡æ•°</button>
                            <button id="toggle-columns-btn" class="btn btn-warning btn-sm" type="button">åˆ—è®¾ç½®</button>
                            <a href="{:U('Admin/Dingyue/list', array('order'=>'count', 'type'=>($order=='count' && $type=='desc')?'asc':'desc'))}" class="btn btn-info btn-sm">
                                <i class="fa fa-apple"></i> è‹¹æœ{$order=='count'?($type=='desc'?'â†“':'â†‘'):''}
                            </a>
                            <a href="{:U('Admin/Dingyue/list', array('order'=>'drivers', 'type'=>($order=='drivers' && $type=='desc')?'asc':'desc'))}" class="btn btn-success btn-sm">
                                <i class="fa fa-users"></i> åœ¨çº¿{$order=='drivers'?($type=='desc'?'â†“':'â†‘'):''}
                            </a>
                            <a href="{:U('Admin/Dingyue/list', array('order'=>'addtime', 'type'=>($order=='addtime' && $type=='desc')?'asc':'desc'))}" class="btn btn-secondary btn-sm">
                                <i class="fa fa-plus"></i> æœ€æ–°{$order=='addtime'?($type=='desc'?'â†“':'â†‘'):''}
                            </a>
                        </form>
                    </div>
                </div>
            </div>

            <!-- æ’åºçŠ¶æ€æ˜¾ç¤º -->
            <if condition="$order">
            <div class="sort-status-bar">
                <i class="fa fa-sort"></i>
                <span style="color: #595959;">å½“å‰æ’åºï¼š</span>
                <span style="color: #1677ff; font-weight: 500;">
                    <if condition="$order=='addtime'">æ·»åŠ æ—¶é—´
                    <elseif condition="$order=='endtime'" />ç»“æŸæ—¶é—´
                    <elseif condition="$order=='count'" />è‹¹æœ
                    <elseif condition="$order=='clashcount'" />clash
                    <elseif condition="$order=='drivers'" />åœ¨çº¿
                    <elseif condition="$order=='setdrivers'" />æœ€å¤§è®¾å¤‡æ•°
                    <else />æœªçŸ¥å­—æ®µ
                    </if>
                </span>
                <span style="color: #8c8c8c;">ï¼ˆ{$type=='desc'?'é™åº':'å‡åº'}ï¼‰</span>
                <a href="{:U('Admin/Dingyue/list')}"><i class="fa fa-times"></i> æ¸…é™¤æ’åº</a>
            </div>
            </if>

            <!-- æ‰¹é‡æ“ä½œå·¥å…·æ  -->
            <div class="batch-toolbar">
                <div class="batch-left">
                    <label><input type="checkbox" class="alls"> å…¨é€‰</label>
                    <div id="allDel" class="btn btn-danger btn-sm">å…¨éƒ¨åˆ é™¤</div>
                    <div id="allPush" class="btn btn-info btn-sm">å…¨éƒ¨å‘é€</div>
                    <div id="allDisable" class="btn btn-warning btn-sm">å…¨éƒ¨ç¦ç”¨</div>
                    <div id="allEnable" class="btn btn-success btn-sm">å…¨éƒ¨å¯ç”¨</div>
                </div>
            </div>

            <!-- æ¡Œé¢ç«¯è¡¨æ ¼ -->
            <div class="desktop-table">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                    <tr>
                        <th></th>
                        <th width="10%">qqå·ç </th>
                        <th>ç»“æŸæ—¶é—´</th>
                        <th>äºŒç»´ç </th>
                        <th>æ‰‹æœºçŸ­é“¾</th>
                        <th>clashçŸ­é“¾</th>
                        <th class="col-addtime">
                            <div class="sortable-header {$order=='addtime'?'active':''}" data-order="addtime" data-type="{$order=='addtime' && $type=='desc'?'asc':'desc'}">
                                <span>æ·»åŠ æ—¶é—´</span>
                                <div class="sort-arrow">
                                    <if condition="$order=='addtime'">
                                        <if condition="$type=='desc'">
                                            <i class="fa fa-sort-down"></i>
                                            <span class="sort-indicator active">é™åº</span>
                                        <else />
                                            <i class="fa fa-sort-up"></i>
                                            <span class="sort-indicator active">å‡åº</span>
                                        </if>
                                    <else />
                                        <i class="fa fa-sort"></i>
                                    </if>
                                </div>
                            </div>
                        </th>
                        <th class="col-endtime">
                            <div class="sortable-header {$order=='endtime'?'active':''}" data-order="endtime" data-type="{$order=='endtime' && $type=='desc'?'asc':'desc'}">
                                <span>ç»“æŸæ—¶é—´</span>
                                <div class="sort-arrow">
                                    <if condition="$order=='endtime'">
                                        <if condition="$type=='desc'">
                                            <i class="fa fa-sort-down"></i>
                                            <span class="sort-indicator active">é™åº</span>
                                        <else />
                                            <i class="fa fa-sort-up"></i>
                                            <span class="sort-indicator active">å‡åº</span>
                                        </if>
                                    <else />
                                        <i class="fa fa-sort"></i>
                                    </if>
                                </div>
                            </div>
                        </th>
                        <th class="col-count">
                            <div class="sortable-header {$order=='count'?'active':''}" data-order="count" data-type="{$order=='count' && $type=='desc'?'asc':'desc'}">
                                <span>è‹¹æœ</span>
                                <div class="sort-arrow">
                                    <if condition="$order=='count'">
                                        <if condition="$type=='desc'">
                                            <i class="fa fa-sort-down"></i>
                                            <span class="sort-indicator active">é™åº</span>
                                        <else />
                                            <i class="fa fa-sort-up"></i>
                                            <span class="sort-indicator active">å‡åº</span>
                                        </if>
                                    <else />
                                        <i class="fa fa-sort"></i>
                                    </if>
                                </div>
                            </div>
                        </th>
                        <th class="col-clashcount">
                            <div class="sortable-header {$order=='clashcount'?'active':''}" data-order="clashcount" data-type="{$order=='clashcount' && $type=='desc'?'asc':'desc'}">
                                <span>clash</span>
                                <div class="sort-arrow">
                                    <if condition="$order=='clashcount'">
                                        <if condition="$type=='desc'">
                                            <i class="fa fa-sort-down"></i>
                                            <span class="sort-indicator active">é™åº</span>
                                        <else />
                                            <i class="fa fa-sort-up"></i>
                                            <span class="sort-indicator active">å‡åº</span>
                                        </if>
                                    <else />
                                        <i class="fa fa-sort"></i>
                                    </if>
                                </div>
                            </div>
                        </th>
                        <th class="col-drivers">
                            <div class="sortable-header {$order=='drivers'?'active':''}" data-order="drivers" data-type="{$order=='drivers' && $type=='desc'?'asc':'desc'}">
                                <span>åœ¨çº¿</span>
                                <div class="sort-arrow">
                                    <if condition="$order=='drivers'">
                                        <if condition="$type=='desc'">
                                            <i class="fa fa-sort-down"></i>
                                            <span class="sort-indicator active">é™åº</span>
                                        <else />
                                            <i class="fa fa-sort-up"></i>
                                            <span class="sort-indicator active">å‡åº</span>
                                        </if>
                                    <else />
                                        <i class="fa fa-sort"></i>
                                    </if>
                                </div>
                            </div>
                        </th>
                        <th class="col-setdrivers">
                            <div class="sortable-header {$order=='setdrivers'?'active':''}" data-order="setdrivers" data-type="{$order=='setdrivers' && $type=='desc'?'asc':'desc'}">
                                <span>æœ€å¤§è®¾å¤‡æ•°</span>
                                <div class="sort-arrow">
                                    <if condition="$order=='setdrivers'">
                                        <if condition="$type=='desc'">
                                            <i class="fa fa-sort-down"></i>
                                            <span class="sort-indicator active">é™åº</span>
                                        <else />
                                            <i class="fa fa-sort-up"></i>
                                            <span class="sort-indicator active">å‡åº</span>
                                        </if>
                                    <else />
                                        <i class="fa fa-sort"></i>
                                    </if>
                                </div>
                            </div>
                        </th>
                        <th>æ“ä½œ</th>
                    </tr>
                    <foreach name="data" item="v">
                        <tr>
                            <td colspan="13" style="background:#fffbe6;color:#d48806;" <if condition="isset($v['history_match'])">style="background:#fffbe6;color:#d48806;"</if>>
                                <if condition="isset($v['history_match'])">
                                    <b>æç¤ºï¼š</b> è¯¥ç»“æœé€šè¿‡å†å²è®¢é˜…åœ°å€æŸ¥è¯¢è·å¾—ï¼Œå†å²å˜æ›´æ—¶é—´ï¼š{$v['history_match']['change_time']|date='Y-m-d H:i:s',###}ï¼ŒåŸåœ°å€ï¼š{$v['history_match']['old_url']}ï¼Œæ–°åœ°å€ï¼š{$v['history_match']['new_url']}
                                </if>
                            </td>
                        </tr>
                        <tr>
                            <td><input type="checkbox" class="all" name="all" value="{$v['id']}"></td>
                            <td width="10%">
                                <div style="display: flex; flex-direction: column; align-items: flex-start;">
                                    <span style="margin-bottom: 4px;">{$v['qq']}</span>
                                    <a href="{:U('Admin/Dingyue/customerDetail',array('id'=>$v['id']))}" class="btn btn-xs btn-success" title="æŸ¥çœ‹å®¢æˆ·è¯¦æƒ…">
                                        <i class="fa fa-user"></i> è¯¦æƒ…
                                    </a>
                                </div>
                            </td>
                            <td>
                                <div>
                                    <input type="date" class="endtime" data="{$v['id']}" value="{$v['endtime']}">
                                    <div class="desktop-quick-date-buttons quick-date-buttons">
                                        <button type="button" class="quick-date-btn" data-days="31" data-id="{$v['id']}">+ä¸€æœˆ</button>
                                        <button type="button" class="quick-date-btn" data-days="365" data-id="{$v['id']}">+ä¸€å¹´</button>
                                        <button type="button" class="quick-date-btn" data-days="182" data-id="{$v['id']}">+åŠå¹´</button>
                                    </div>
                                </div>
                            </td>
                            <td><img class="show-qrcode-btn" src="data:image/png;base64,{$v['qrcodeUrl']}" style="max-width:60px;max-height:60px;cursor:pointer;"></td>
                            <td style="max-width:120px;overflow:auto;">
                                <span class="copy-link" data-clipboard-text="{$v['mobileshorturl']}">{$v['mobileshorturl']}</span>
                            </td>
                            <td style="max-width:120px;overflow:auto;">
                                <span class="copy-link" data-clipboard-text="{$v['clashshorturl']}">{$v['clashshorturl']}</span>
                            </td>
                            <td class="col-addtime">{$v['addtime']}</td>
                            <td class="col-endtime">{$v['endtime']}</td>
                            <td class="col-count">{$v['count']}</td>
                            <td class="col-clashcount">{$v['clashcount']}</td>
                            <td class="col-drivers">{$v['drivers']}</td>
                            <td class="col-setdrivers">
                                <input type="number" min="1" class="setdrivers-input" data-id="{$v['id']}" value="{:isset($v['setdrivers']) ? $v['setdrivers'] : 1}" style="width:80px;">
                                <div class="quick-device-buttons">
                                    <button type="button" class="quick-device-btn" data-devices="5" data-id="{$v['id']}">+5</button>
                                    <button type="button" class="quick-device-btn" data-devices="10" data-id="{$v['id']}">+10</button>
                                    <button type="button" class="quick-device-btn" data-devices="15" data-id="{$v['id']}">+15</button>
                                </div>
                            </td>
                            <td>
                                <a class="btn btn-xs btn-success" href="{:U('Admin/Dingyue/loginAsUser',array('id'=>$v['id']))}" target="_blank" title="è¿›å…¥ç”¨æˆ·åå°">åå°</a>
                                <a class="btn btn-xs btn-primary" onClick="return confirm('ç¡®å®šé‡ç½®è¯¥ç”¨æˆ·çš„è®¢é˜…åœ°å€å—ï¼Ÿ');" href="{:U('Admin/Dingyue/resetSubscription',array('id'=>$v['id']))}" title="é‡ç½®è®¢é˜…åœ°å€">é‡ç½®</a>
                                <a class="btn btn-xs btn-info" href="{:U('Admin/Dingyue/sendmail',array('id'=>$v['id']))}" title="å‘é€é‚®ä»¶">å‘é€</a>
                                <a class="btn btn-xs btn-warning" href="{:U('Admin/Dingyue/edit',array('id'=>$v['id']))}" title="ä¿®æ”¹ä¿¡æ¯">ä¿®æ”¹</a>
                                <a class="btn btn-xs btn-danger dingyue-del-btn" data-id="{$v['id']}" href="javascript:void(0);" title="åˆ é™¤">åˆ é™¤</a>
                                <a class="btn btn-xs btn-danger clean-drivers-btn" data-id="{$v['id']}" href="javascript:void(0);" title="æ¸…ç†åœ¨çº¿è®¾å¤‡æ•°">æ¸…ç†</a>
                            </td>
                        </tr>
                    </foreach>
                </table>
                </div>
            </div>

            <!-- æ‰‹æœºç«¯å¡ç‰‡åˆ—è¡¨ -->
            <div class="mobile-card-list">
                <foreach name="data" item="v">
                    <div class="mobile-card">
                        <input type="checkbox" class="mobile-card-checkbox all" name="all" value="{$v['id']}">

                        <div class="mobile-card-header">
                            <div class="mobile-card-qq">{$v['qq']}</div>
                        </div>

                        <div class="mobile-card-content">
                            <div class="mobile-card-row">
                                <span class="mobile-card-label">åˆ°æœŸæ—¶é—´:</span>
                                <div class="mobile-card-value">
                                    <input type="date" class="endtime-date" data="{$v['id']}" value="{$v['endtime']}" style="width:100%;">
                                    <div class="quick-date-buttons">
                                        <button type="button" class="quick-date-btn" data-days="31" data-id="{$v['id']}">+ä¸€æœˆ</button>
                                        <button type="button" class="quick-date-btn" data-days="365" data-id="{$v['id']}">+ä¸€å¹´</button>
                                        <button type="button" class="quick-date-btn" data-days="182" data-id="{$v['id']}">+åŠå¹´</button>
                                    </div>
                                </div>
                            </div>
                            <div class="mobile-card-row">
                                <span class="mobile-card-label">æœ€å¤§è®¾å¤‡æ•°:</span>
                                <div class="mobile-card-value">
                                    <input type="number" min="1" class="setdrivers-input" data-id="{$v['id']}" value="{:isset($v['setdrivers']) ? $v['setdrivers'] : 1}" style="width:100px;">
                                    <div class="quick-device-buttons">
                                        <button type="button" class="quick-device-btn" data-devices="5" data-id="{$v['id']}">+5</button>
                                        <button type="button" class="quick-device-btn" data-devices="10" data-id="{$v['id']}">+10</button>
                                        <button type="button" class="quick-device-btn" data-devices="15" data-id="{$v['id']}">+15</button>
                                    </div>
                                </div>
                            </div>
                            <div class="mobile-card-row">
                                <span class="mobile-card-label">å½“å‰è®¾å¤‡æ•°:</span>
                                <span class="mobile-card-value">{$v['drivers']} / {$v['setdrivers']}</span>
                            </div>
                            <div class="mobile-card-row">
                                <span class="mobile-card-label">è¯·æ±‚æ¬¡æ•°:</span>
                                <span class="mobile-card-value">{$v['count']}</span>
                            </div>
                            <div class="mobile-card-row">
                                <span class="mobile-card-label">Clashè¯·æ±‚:</span>
                                <span class="mobile-card-value">{$v['clashcount']}</span>
                            </div>
                        </div>
                        <div class="mobile-card-qrcode">
                            <div class="mobile-card-qrcode-title">äºŒç»´ç </div>
                            <img class="mobile-card-qrcode-img show-qrcode-btn" src="data:image/png;base64,{$v['qrcodeUrl']}" alt="QR Code">
                        </div>
                        <div class="mobile-card-links">
                            <div class="mobile-card-link" onclick="copyToClipboard('{$v.mobileshorturl}')">
                                <span class="mobile-card-link-icon">ğŸ“±</span>
                                <div class="mobile-card-link-text">æ‰‹æœºçŸ­é“¾</div>
                                <div class="mobile-card-link-url">{$v.mobileshorturl}</div>
                            </div>
                            <div class="mobile-card-link" onclick="copyToClipboard('{$v.clashshorturl}')">
                                <span class="mobile-card-link-icon">âš¡</span>
                                <div class="mobile-card-link-text">ClashçŸ­é“¾</div>
                                <div class="mobile-card-link-url">{$v.clashshorturl}</div>
                            </div>
                        </div>
                        <div class="mobile-card-actions">
                            <a class="btn btn-xs btn-success" href="{:U('Admin/Dingyue/customerDetail',array('id'=>$v['id']))}" title="å®¢æˆ·è¯¦æƒ…">
                                <i class="fa fa-user"></i> è¯¦æƒ…
                            </a>
                            <a class="btn btn-xs btn-success" href="{:U('Admin/Dingyue/loginAsUser',array('id'=>$v['id']))}" target="_blank" title="è¿›å…¥ç”¨æˆ·åå°">
                                <i class="fa fa-sign-in"></i> åå°
                            </a>
                            <a class="btn btn-xs btn-primary" onClick="return confirm('ç¡®å®šé‡ç½®è¯¥ç”¨æˆ·çš„è®¢é˜…åœ°å€å—ï¼Ÿ');" href="{:U('Admin/Dingyue/resetSubscription',array('id'=>$v['id']))}" title="é‡ç½®è®¢é˜…åœ°å€">
                                <i class="fa fa-refresh"></i> é‡ç½®
                            </a>
                            <a class="btn btn-xs btn-info" href="{:U('Admin/Dingyue/sendmail',array('id'=>$v['id']))}">
                                <i class="fa fa-envelope"></i> å‘é€
                            </a>
                            <a class="btn btn-xs btn-warning" href="{:U('Admin/Dingyue/edit',array('id'=>$v['id']))}">
                                <i class="fa fa-edit"></i> ä¿®æ”¹
                            </a>
                            <a class="btn btn-xs btn-danger dingyue-del-btn" data-id="{$v['id']}" href="javascript:void(0);">
                                <i class="fa fa-trash"></i> åˆ é™¤
                            </a>
                            <a class="btn btn-xs btn-danger clean-drivers-btn" data-id="{$v['id']}" href="javascript:void(0);">
                                <i class="fa fa-broom"></i> æ¸…ç†
                            </a>
                            <a class="btn btn-xs btn-success mobile-activate-btn" data-id="{$v['id']}" href="javascript:void(0);" title="æ¿€æ´»è´¦å·">
                                <i class="fa fa-check-circle"></i> æ¿€æ´»
                            </a>
                        </div>
                    </div>
                </foreach>
            </div>

            <!-- åˆ†é¡µåŒºåŸŸ -->
            <div class="page-footer">
                <div class="pagination-info">å…± {$totalCount} æ¡è®°å½•</div>
                <div class="pagination-container">
                    <div class="pagination" id="pagination-container">{$page}</div>
                    <div class="pagination-jump">
                        <span>è·³è½¬åˆ°</span>
                        <input type="number" id="jumpPage" min="1" placeholder="é¡µç ">
                        <button id="jumpButton" class="btn btn-primary">ç¡®å®š</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- äºŒç»´ç æ¨¡æ€æ¡† -->
    <div class="qrcode-modal" id="qrcodeModal">
        <img id="modalQrcode" src="" alt="QR Code">
    </div>
    <!-- åˆ—è®¾ç½®æ¨¡æ€æ¡† -->
    <div id="column-settings-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>åˆ—å®½è®¾ç½®</h3>
                <button class="close-btn" id="close-settings-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="column-settings">
                    <div class="setting-item">
                        <label>QQå·ç :</label>
                        <input type="range" id="qq-width" min="60" max="150" value="100" onchange="updateColumnWidth(2, this.value)">
                        <span id="qq-width-value">100px</span>
                    </div>
                    <div class="setting-item">
                        <label>ç»“æŸæ—¶é—´:</label>
                        <input type="range" id="endtime-width" min="100" max="200" value="140" onchange="updateColumnWidth(3, this.value)">
                        <span id="endtime-width-value">140px</span>
                    </div>
                    <div class="setting-item">
                        <label>äºŒç»´ç :</label>
                        <input type="range" id="qrcode-width" min="50" max="100" value="70" onchange="updateColumnWidth(4, this.value)">
                        <span id="qrcode-width-value">70px</span>
                    </div>
                    <div class="setting-item">
                        <label>æ‰‹æœºçŸ­é“¾:</label>
                        <input type="range" id="mobile-width" min="100" max="200" value="150" onchange="updateColumnWidth(5, this.value)">
                        <span id="mobile-width-value">150px</span>
                    </div>
                    <div class="setting-item">
                        <label>ClashçŸ­é“¾:</label>
                        <input type="range" id="clash-width" min="100" max="200" value="150" onchange="updateColumnWidth(6, this.value)">
                        <span id="clash-width-value">150px</span>
                    </div>
                    <div class="setting-item">
                        <label>æ·»åŠ æ—¶é—´:</label>
                        <input type="range" id="addtime-width" min="60" max="120" value="80" onchange="updateColumnWidth(7, this.value)">
                        <span id="addtime-width-value">80px</span>
                    </div>
                    <div class="setting-item">
                        <label>ç»“æŸæ—¶é—´:</label>
                        <input type="range" id="endtime2-width" min="60" max="120" value="80" onchange="updateColumnWidth(8, this.value)">
                        <span id="endtime2-width-value">80px</span>
                    </div>
                    <div class="setting-item">
                        <label>è‹¹æœ:</label>
                        <input type="range" id="apple-width" min="40" max="80" value="60" onchange="updateColumnWidth(9, this.value)">
                        <span id="apple-width-value">60px</span>
                    </div>
                    <div class="setting-item">
                        <label>clash:</label>
                        <input type="range" id="clashcount-width" min="40" max="80" value="60" onchange="updateColumnWidth(10, this.value)">
                        <span id="clashcount-width-value">60px</span>
                    </div>
                    <div class="setting-item">
                        <label>åœ¨çº¿:</label>
                        <input type="range" id="online-width" min="40" max="80" value="60" onchange="updateColumnWidth(11, this.value)">
                        <span id="online-width-value">60px</span>
                    </div>
                    <div class="setting-item">
                        <label>æœ€å¤§è®¾å¤‡æ•°:</label>
                        <input type="range" id="maxdevices-width" min="80" max="150" value="120" onchange="updateColumnWidth(12, this.value)">
                        <span id="maxdevices-width-value">120px</span>
                    </div>
                    <div class="setting-item">
                        <label>æ“ä½œåˆ—æœ€å°å®½åº¦:</label>
                        <input type="range" id="action-width" min="120" max="300" value="160" onchange="updateActionColumnWidth(this.value)">
                        <span id="action-width-value">160px</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-primary" id="save-settings-btn">ä¿å­˜è®¾ç½®</button>
                    <button class="btn btn-secondary" id="reset-settings-btn">é‡ç½®é»˜è®¤</button>
                    <button class="btn btn-danger" id="cancel-settings-btn">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>
    <script src="__PUBLIC__/statics/js/jquery-3.6.0.min.js"></script>
    <script src="__PUBLIC__/statics/user/clipboard.min.js"></script>
    <script src="__PUBLIC__/statics/layer/layer.js"></script>
    <script type="text/javascript">
        // å…¨å±€å‡½æ•°å®šä¹‰
        function openColumnSettings() {
            $('#column-settings-modal').show();
            loadCurrentSettings();
        }

        function closeColumnSettings() {
            $('#column-settings-modal').hide();
        }

        function loadCurrentSettings() {
            // ä»localStorageåŠ è½½å½“å‰è®¾ç½®
            var settings = JSON.parse(localStorage.getItem('dingyue_column_widths') || '{}');

            // è®¾ç½®æ»‘å—çš„å€¼
            $('#qq-width').val(settings.qq || 100);
            $('#endtime-width').val(settings.endtime || 140);
            $('#qrcode-width').val(settings.qrcode || 70);
            $('#mobile-width').val(settings.mobile || 150);
            $('#clash-width').val(settings.clash || 150);
            $('#addtime-width').val(settings.addtime || 80);
            $('#endtime2-width').val(settings.endtime2 || 80);
            $('#apple-width').val(settings.apple || 60);
            $('#clashcount-width').val(settings.clashcount || 60);
            $('#online-width').val(settings.online || 60);
            $('#maxdevices-width').val(settings.maxdevices || 120);
            $('#action-width').val(settings.action || 160);

            // æ›´æ–°æ˜¾ç¤ºçš„å€¼
            updateAllValueDisplays();
        }

        function updateColumnWidth(columnIndex, width) {
            var selector = '.table th:nth-child(' + columnIndex + '), .table td:nth-child(' + columnIndex + ')';
            $(selector).css('width', width + 'px');

            // æ›´æ–°æ˜¾ç¤ºçš„å€¼
            updateValueDisplay(columnIndex, width);
        }

        function updateActionColumnWidth(width) {
            $('.table th:nth-child(13), .table td:nth-child(13)').css('min-width', width + 'px');
            $('#action-width-value').text(width + 'px');
        }

        function updateValueDisplay(columnIndex, width) {
            var idMap = {
                2: 'qq-width-value',
                3: 'endtime-width-value',
                4: 'qrcode-width-value',
                5: 'mobile-width-value',
                6: 'clash-width-value',
                7: 'addtime-width-value',
                8: 'endtime2-width-value',
                9: 'apple-width-value',
                10: 'clashcount-width-value',
                11: 'online-width-value',
                12: 'maxdevices-width-value'
            };

            if (idMap[columnIndex]) {
                $('#' + idMap[columnIndex]).text(width + 'px');
            }
        }

        function updateAllValueDisplays() {
            $('#qq-width-value').text($('#qq-width').val() + 'px');
            $('#endtime-width-value').text($('#endtime-width').val() + 'px');
            $('#qrcode-width-value').text($('#qrcode-width').val() + 'px');
            $('#mobile-width-value').text($('#mobile-width').val() + 'px');
            $('#clash-width-value').text($('#clash-width').val() + 'px');
            $('#addtime-width-value').text($('#addtime-width').val() + 'px');
            $('#endtime2-width-value').text($('#endtime2-width').val() + 'px');
            $('#apple-width-value').text($('#apple-width').val() + 'px');
            $('#clashcount-width-value').text($('#clashcount-width').val() + 'px');
            $('#online-width-value').text($('#online-width').val() + 'px');
            $('#maxdevices-width-value').text($('#maxdevices-width').val() + 'px');
            $('#action-width-value').text($('#action-width').val() + 'px');
        }

        function saveColumnSettings() {
            var settings = {
                qq: parseInt($('#qq-width').val()),
                endtime: parseInt($('#endtime-width').val()),
                qrcode: parseInt($('#qrcode-width').val()),
                mobile: parseInt($('#mobile-width').val()),
                clash: parseInt($('#clash-width').val()),
                addtime: parseInt($('#addtime-width').val()),
                endtime2: parseInt($('#endtime2-width').val()),
                apple: parseInt($('#apple-width').val()),
                clashcount: parseInt($('#clashcount-width').val()),
                online: parseInt($('#online-width').val()),
                maxdevices: parseInt($('#maxdevices-width').val()),
                action: parseInt($('#action-width').val())
            };

            localStorage.setItem('dingyue_column_widths', JSON.stringify(settings));

            // åº”ç”¨è®¾ç½®
            applyColumnSettings(settings);

            layer.msg('åˆ—å®½è®¾ç½®å·²ä¿å­˜');
            closeColumnSettings();
        }

        function resetColumnSettings() {
            localStorage.removeItem('dingyue_column_widths');
            layer.msg('å·²é‡ç½®ä¸ºé»˜è®¤è®¾ç½®ï¼Œåˆ·æ–°é¡µé¢åç”Ÿæ•ˆ');
            closeColumnSettings();
            location.reload();
        }

        function applyColumnSettings(settings) {
            if (settings.qq) updateColumnWidth(2, settings.qq);
            if (settings.endtime) updateColumnWidth(3, settings.endtime);
            if (settings.qrcode) updateColumnWidth(4, settings.qrcode);
            if (settings.mobile) updateColumnWidth(5, settings.mobile);
            if (settings.clash) updateColumnWidth(6, settings.clash);
            if (settings.addtime) updateColumnWidth(7, settings.addtime);
            if (settings.endtime2) updateColumnWidth(8, settings.endtime2);
            if (settings.apple) updateColumnWidth(9, settings.apple);
            if (settings.clashcount) updateColumnWidth(10, settings.clashcount);
            if (settings.online) updateColumnWidth(11, settings.online);
            if (settings.maxdevices) updateColumnWidth(12, settings.maxdevices);
            if (settings.action) updateActionColumnWidth(settings.action);
        }

        $(function () {
            // æ’åºåŠŸèƒ½ç‚¹å‡»äº‹ä»¶
            $('.sortable-header').click(function () {
                var order = $(this).data('order');
                var type = $(this).data('type');

                // æ˜¾ç¤ºåŠ è½½æç¤º
                layer.load(1, {shade: [0.3, '#000']});

                var url = new URL(window.location.href);
                url.searchParams.set('order', order);
                url.searchParams.set('type', type);
                // é‡ç½®é¡µç åˆ°ç¬¬ä¸€é¡µ
                url.searchParams.set('p', '1');

                // ç›´æ¥è·³è½¬åˆ°æ’åºåçš„é¡µé¢
                window.location.href = url.toString();
            });

            // æ·»åŠ æ’åºæç¤º
            $('.sortable-header').hover(
                function() {
                    var order = $(this).data('order');
                    var type = $(this).data('type');
                    var orderText = '';

                    switch(order) {
                        case 'addtime': orderText = 'æ·»åŠ æ—¶é—´'; break;
                        case 'endtime': orderText = 'ç»“æŸæ—¶é—´'; break;
                        case 'count': orderText = 'è‹¹æœ'; break;
                        case 'clashcount': orderText = 'clash'; break;
                        case 'drivers': orderText = 'åœ¨çº¿'; break;
                        case 'setdrivers': orderText = 'æœ€å¤§è®¾å¤‡æ•°'; break;
                        default: orderText = 'æœªçŸ¥å­—æ®µ';
                    }

                    $(this).attr('title', 'ç‚¹å‡»æŒ‰' + orderText + (type === 'asc' ? 'å‡åº' : 'é™åº') + 'æ’åˆ—');
                },
                function() {
                    $(this).removeAttr('title');
                }
            );

            // å¿«é€Ÿæ’åºæŒ‰é’®ç‚¹å‡»æ•ˆæœ
            $('.quick-sort-buttons .btn').click(function() {
                layer.load(1, {shade: [0.3, '#000']});

                // ä¿æŒå…¶ä»–å‚æ•°ï¼ˆå¦‚æœç´¢å‚æ•°ï¼‰
                var currentUrl = new URL(window.location.href);
                var href = $(this).attr('href');
                var targetUrl = new URL(href);

                // ä¿æŒæœç´¢å‚æ•°
                var search = currentUrl.searchParams.get('search');
                if (search) {
                    targetUrl.searchParams.set('search', search);
                }

                // ä¿æŒå…¶ä»–å¯èƒ½çš„å‚æ•°
                var tab = currentUrl.searchParams.get('tab');
                if (tab) {
                    targetUrl.searchParams.set('tab', tab);
                }

                // æ›´æ–°é“¾æ¥å¹¶è·³è½¬
                $(this).attr('href', targetUrl.toString());
            });

            // æ¸…é™¤æ’åºæŒ‰é’®ç‚¹å‡»æ•ˆæœ
            $('.sort-status-bar a').click(function() {
                layer.load(1, {shade: [0.3, '#000']});

                // ä¿æŒå…¶ä»–å‚æ•°ï¼ˆå¦‚æœç´¢å‚æ•°ã€é¡µç ç­‰ï¼‰
                var currentUrl = new URL(window.location.href);
                var href = $(this).attr('href');
                var targetUrl = new URL(href);

                // ä¿æŒæœç´¢å‚æ•°
                var search = currentUrl.searchParams.get('search');
                if (search) {
                    targetUrl.searchParams.set('search', search);
                }

                // ä¿æŒæ ‡ç­¾é¡µå‚æ•°
                var tab = currentUrl.searchParams.get('tab');
                if (tab) {
                    targetUrl.searchParams.set('tab', tab);
                }

                // ä¿æŒé¡µç å‚æ•°
                var page = currentUrl.searchParams.get('p');
                if (page) {
                    targetUrl.searchParams.set('p', page);
                }

                // æ›´æ–°é“¾æ¥å¹¶è·³è½¬
                $(this).attr('href', targetUrl.toString());
            });

            $('.alls').change(function(){
                var check = $(this).prop('checked');
                $('.all').prop('checked',check);
            })
            // å•ä¸ªåˆ é™¤ï¼ˆAJAXï¼‰
            $('.dingyue-del-btn').off('click').on('click', function(){
                var id = $(this).data('id');
                layer.confirm('ç¡®å®šåˆ é™¤?', {icon: 3, title:'æç¤º'}, function(index){
                    $.get('{:U("Admin/Dingyue/del")}?id='+id, function(res){
                        var successMsg = 'è¯¥è´¦å·ä¸‹æ‰€æœ‰è®¢é˜…ã€é‚®ä»¶ã€ç”¨æˆ·ä¿¡æ¯ã€æ—¥å¿—ã€è®¾å¤‡è®°å½•ç­‰ä¿¡æ¯å·²å…¨éƒ¨æ¸…é™¤';
                        if(typeof res === 'string'){
                            try{res=JSON.parse(res);}catch(e){
                                layer.msg(successMsg, {icon:1, time:2000}, function(){ location.reload(); });
                                return;
                            }
                        }
                        if(res && res.status==1){
                            layer.msg(successMsg, {icon:1, time:2000}, function(){ location.reload(); });
                        }else{
                            layer.msg(res&&res.info?res.info:'åˆ é™¤å¤±è´¥', {icon:2});
                        }
                    });
                    layer.close(index);
                });
            });
            // è·å–é€‰ä¸­çš„ID
            function getCheckedIds() {
                var chk_value = [];
                $('input[name="all"]:checked').each(function(){
                    chk_value.push($(this).val());
                });
                if(chk_value.length === 0){
                    layer.msg('è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„é¡¹', {icon: 0});
                    return false;
                }
                return chk_value;
            }
            // æ‰¹é‡æ“ä½œç¾åŒ–æç¤º
            function showLayerMsg(msg, success) {
                layer.msg(msg, {icon: success?1:2, time: 1500}, function(){ if(success) location.reload(); });
            }
            // æ‰¹é‡åˆ é™¤
            $('#allDel').off('click').on('click', function () {
                var chk_value = getCheckedIds();
                if(!chk_value){ return; }
                // åªä¿ç•™layer.confirmå¼¹çª—ï¼Œå»é™¤åŸç”Ÿconfirm
                layer.confirm('ç¡®å®šå…¨éƒ¨åˆ é™¤?', {icon:3, title:'æç¤º'}, function(index){
                    var hasPopup = false;
                    $.post('{:U("Admin/Dingyue/allDel")}', {id:chk_value}, function(res){
                        var successMsg = 'æ‰€é€‰è´¦å·ä¸‹æ‰€æœ‰è®¢é˜…ã€é‚®ä»¶ã€ç”¨æˆ·ä¿¡æ¯ã€æ—¥å¿—ã€è®¾å¤‡è®°å½•ç­‰ä¿¡æ¯å·²å…¨éƒ¨æ¸…é™¤';
                        if(typeof res === 'string'){
                            try{res=JSON.parse(res);}catch(e){
                                if(!hasPopup){
                                    hasPopup = true;
                                    layer.msg(successMsg, {icon: 1, time: 1500}, function(){location.reload();});
                                }
                                return;
                            }
                        }
                        if(!hasPopup){
                            hasPopup = true;
                            layer.msg(res.info || successMsg, {icon: res.status==1?1:2, time: 1500}, function(){
                                if(res.status==1){location.reload();}
                            });
                        }
                    }, 'json').fail(function(){
                        if(!hasPopup){
                            hasPopup = true;
                            layer.msg('æ‰€é€‰è´¦å·ä¸‹æ‰€æœ‰è®¢é˜…ã€é‚®ä»¶ã€ç”¨æˆ·ä¿¡æ¯ã€æ—¥å¿—ã€è®¾å¤‡è®°å½•ç­‰ä¿¡æ¯å·²å…¨éƒ¨æ¸…é™¤', {icon: 1, time: 1500}, function(){location.reload();});
                        }
                    });
                    layer.close(index);
                });
            });
            // æ‰¹é‡å‘é€
            $('#allPush').click(function () {
                var chk_value = getCheckedIds();
                if(!chk_value){ return; }
                layer.confirm('ç¡®å®šå…¨éƒ¨å‘é€?', {icon:3, title:'æç¤º'}, function(index){
                    $.post("{:U('Admin/Dingyue/allPush')}", {id:chk_value}, function(res){
                        showLayerMsg(res.info, res.status == 1);
                    }, 'json');
                    layer.close(index);
                });
            });
            // æ‰¹é‡ç¦ç”¨
            $('#allDisable').click(function () {
                var chk_value = getCheckedIds();
                if(!chk_value){ return; }
                layer.confirm('ç¡®å®šå…¨éƒ¨ç¦ç”¨?', {icon:3, title:'æç¤º'}, function(index){
                    $.post("{:U('Admin/Dingyue/allDisable')}", {id:chk_value}, function(res){
                        showLayerMsg(res.info, res.status == 1);
                    }, 'json');
                    layer.close(index);
                });
            });
            // æ‰¹é‡å¯ç”¨
            $('#allEnable').click(function () {
                var chk_value = getCheckedIds();
                if(!chk_value){ return; }
                layer.confirm('ç¡®å®šå…¨éƒ¨å¯ç”¨?', {icon:3, title:'æç¤º'}, function(index){
                    $.post("{:U('Admin/Dingyue/allEnable')}", {id:chk_value}, function(res){
                        showLayerMsg(res.info, res.status == 1);
                    }, 'json');
                    layer.close(index);
                });
            });
            // æ—¥æœŸé€‰æ‹©å™¨åŠŸèƒ½
            $(function(){
                // æ‰‹æœºç«¯æ—¥æœŸè¾“å…¥æ¡†å˜åŒ–æ—¶è‡ªåŠ¨ä¿å­˜
                $('.endtime-date').change(function (){
                    var id = $(this).attr('data');
                    var vals = $(this).val();
                    if(vals) {
                        $.ajax({
                            url: "{:U('Admin/Dingyue/editTime')}",
                            type:'post',
                            data:{id:id,endtime:vals},
                            success:function(res){
                                if(window.layer){
                                    layer.msg(res && res.info ? res.info : 'åˆ°æœŸæ—¶é—´å·²æ›´æ–°');
                                }
                            }
                        });
                    }
                });

                // æ¡Œé¢ç«¯æ—¥æœŸè¾“å…¥æ¡†å˜åŒ–æ—¶è‡ªåŠ¨ä¿å­˜
                $('.endtime').change(function (){
                    var id = $(this).attr('data');
                    var vals = $(this).val();
                    if(vals) {
                        $.ajax({
                            url: "{:U('Admin/Dingyue/editTime')}",
                            type:'post',
                            data:{id:id,endtime:vals},
                            success:function(res){
                                if(window.layer){
                                    layer.msg(res && res.info ? res.info : 'åˆ°æœŸæ—¶é—´å·²æ›´æ–°');
                                }
                            }
                        });
                    }
                });

                // å¿«é€Ÿæ—¥æœŸæŒ‰é’®åŠŸèƒ½
                $('.quick-date-btn').click(function(){
                    var id = $(this).attr('data-id');
                    var days = parseInt($(this).attr('data-days'));

                    // è·å–å½“å‰ç”¨æˆ·çš„åˆ°æœŸæ—¶é—´
                    var currentEndTime = $('.endtime[data="' + id + '"]').val();
                    var currentDate = new Date();
                    var endTimeDate = new Date(currentEndTime);

                    var newDate;

                    // åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åœ¨æœ‰æ•ˆæœŸå†…
                    if (endTimeDate > currentDate) {
                        // åœ¨æœ‰æ•ˆæœŸå†…ï¼šåœ¨åŸåˆ°æœŸæ—¶é—´åŸºç¡€ä¸Šç´¯åŠ 
                        endTimeDate.setDate(endTimeDate.getDate() + days);
                        newDate = endTimeDate.getFullYear() + '-' +
                                 String(endTimeDate.getMonth() + 1).padStart(2, '0') + '-' +
                                 String(endTimeDate.getDate()).padStart(2, '0');
                    } else {
                        // ä¸åœ¨æœ‰æ•ˆæœŸå†…ï¼šä»¥å½“å‰æ—¶é—´ä¸ºèµ·ç‚¹è¿›è¡Œæ·»åŠ 
                        currentDate.setDate(currentDate.getDate() + days);
                        newDate = currentDate.getFullYear() + '-' +
                                 String(currentDate.getMonth() + 1).padStart(2, '0') + '-' +
                                 String(currentDate.getDate()).padStart(2, '0');
                    }

                    // æ›´æ–°æ‰‹æœºç«¯è¾“å…¥æ¡†
                    $('.endtime-date[data="' + id + '"]').val(newDate);

                    // æ›´æ–°æ¡Œé¢ç«¯è¾“å…¥æ¡†
                    $('.endtime[data="' + id + '"]').val(newDate);

                    // è‡ªåŠ¨ä¿å­˜
                    $.ajax({
                        url: "{:U('Admin/Dingyue/editTime')}",
                        type:'post',
                        data:{id:id,endtime:newDate},
                        success:function(res){
                            if(window.layer){
                                var timeText = '';
                                if(days === 31) {
                                    timeText = 'ä¸€æœˆ';
                                } else if(days === 365) {
                                    timeText = 'ä¸€å¹´';
                                } else if(days === 183) {
                                    timeText = 'åŠå¹´';
                                } else {
                                    timeText = days + 'å¤©';
                                }
                                layer.msg('åˆ°æœŸæ—¶é—´å·²å»¶é•¿' + timeText);
                            }
                        }
                    });
                });

                // å¿«é€Ÿè®¾å¤‡æ•°é‡æŒ‰é’®åŠŸèƒ½
                $('.quick-device-btn').click(function(){
                    var id = $(this).attr('data-id');
                    var devices = parseInt($(this).attr('data-devices'));
                    var currentValue = parseInt($('.setdrivers-input[data-id="' + id + '"]').val()) || 0;
                    var newValue = currentValue + devices;

                    // æ›´æ–°è¾“å…¥æ¡†å€¼
                    $('.setdrivers-input[data-id="' + id + '"]').val(newValue);

                    // è‡ªåŠ¨ä¿å­˜
                    $.ajax({
                        url: "{:U('Admin/Dingyue/editSetdrivers')}",
                        type:'post',
                        data:{id:id,setdrivers:newValue},
                        success:function(res){
                            if(window.layer){
                                layer.msg('è®¾å¤‡æ•°é‡å·²å¢åŠ ' + devices + 'ä¸ª');
                            }
                        }
                    });
                });
            });

            // å¤åˆ¶çŸ­é“¾åŠŸèƒ½
            var clipboard = new Clipboard('.copy-link', {
                text: function(trigger) {
                    return $(trigger).attr('data-clipboard-text');
                }
            });
            clipboard.on('success', function(e) {
                // å¯ç”¨layeræˆ–alert
                if(window.layer){
                    layer.open({content: 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'});
                }else{
                    alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }
            });
            clipboard.on('error', function(e) {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
            // æ‰‹æœºç«¯å¤åˆ¶åŠŸèƒ½
            window.copyToClipboard = function(text) {
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(text).then(function() {
                        if(window.layer){
                            layer.open({content: 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'});
                        }else{
                            alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                        }
                    }).catch(function(err) {
                        fallbackCopyTextToClipboard(text);
                    });
                } else {
                    fallbackCopyTextToClipboard(text);
                }
            };

            function fallbackCopyTextToClipboard(text) {
                var textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed";
                textArea.style.left = "-999999px";
                textArea.style.top = "-999999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    var successful = document.execCommand('copy');
                    if (successful) {
                        if(window.layer){
                            layer.open({content: 'å·²å¤åˆ¶åˆ°å‰ªè´´æ¿'});
                        }else{
                            alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                        }
                    } else {
                        alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                    }
                } catch (err) {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                }
                textArea.remove();
            }

            // äºŒç»´ç é¢„è§ˆåŠŸèƒ½ï¼ˆç‚¹å‡»æ—¶æ”¾å¤§base64å›¾ç‰‡ï¼‰
            $('.table').on('click', '.show-qrcode-btn', function() {
                var src = $(this).attr('src');
                $('#modalQrcode').attr('src', src);
                $('#qrcodeModal').css('display', 'flex');
            });

            // ç‚¹å‡»æ¨¡æ€æ¡†å…³é—­
            $('#qrcodeModal').click(function() {
                $(this).css('display', 'none');
            });

            // é˜»æ­¢ç‚¹å‡»å›¾ç‰‡æ—¶å…³é—­æ¨¡æ€æ¡†
            $('#modalQrcode').click(function(e) {
                e.stopPropagation();
            });

            // ç”±äºç°åœ¨ä½¿ç”¨ä¼ ç»Ÿé¡µé¢è·³è½¬ï¼Œä¸éœ€è¦é‡æ–°ç»‘å®šäº‹ä»¶
            // é¡µç è·³è½¬åŠŸèƒ½
            $('#jumpButton').click(function () {
                var page = parseInt($('#jumpPage').val());
                if (page > 0) {
                    var url = new URL(window.location.href);
                    url.searchParams.set('p', page);
                    // ä¿æŒæ‰€æœ‰ç°æœ‰å‚æ•°ï¼ˆåŒ…æ‹¬æ’åºå‚æ•°ï¼‰
                    window.location.href = url.toString();
                } else {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„é¡µç ');
                }
            });

            // å›è½¦é”®è·³è½¬
            $('#jumpPage').keypress(function (e) {
                if (e.which === 13) {
                    $('#jumpButton').click();
                }
            });

            // åˆ—è®¾ç½®æŒ‰é’®
            $('#toggle-columns-btn').click(function() {
                openColumnSettings();
            });

            // åŠ è½½ä¿å­˜çš„åˆ—å®½è®¾ç½®
            var savedSettings = JSON.parse(localStorage.getItem('dingyue_column_widths') || '{}');
            if (Object.keys(savedSettings).length > 0) {
                applyColumnSettings(savedSettings);
            }

            // æ‰‹æœºç«¯äºŒç»´ç ç‚¹å‡»æ”¾å¤§
            $(document).on('click', '.mobile-card-qrcode-img', function() {
                var src = $(this).attr('src');
                $('#modalQrcode').attr('src', src);
                $('#qrcodeModal').css('display', 'flex');
            });

            // æ¨¡æ€æ¡†å…³é—­äº‹ä»¶
            $(document).on('click', '.modal-overlay', function(e) {
                if (e.target === this) {
                    closeColumnSettings();
                }
            });

            // ç»‘å®šæ¨¡æ€æ¡†æŒ‰é’®äº‹ä»¶
            $('#close-settings-btn').click(function() {
                closeColumnSettings();
            });

            $('#save-settings-btn').click(function() {
                saveColumnSettings();
            });

            $('#reset-settings-btn').click(function() {
                resetColumnSettings();
            });

            $('#cancel-settings-btn').click(function() {
                closeColumnSettings();
            });

            // ä¸ºæ»‘å—æ·»åŠ å®æ—¶æ›´æ–°äº‹ä»¶
            $(document).on('input', 'input[type="range"]', function() {
                var id = $(this).attr('id');
                var value = $(this).val();

                // æ›´æ–°æ˜¾ç¤ºçš„å€¼
                $('#' + id + '-value').text(value + 'px');

                // å®æ—¶åº”ç”¨åˆ—å®½
                switch(id) {
                    case 'qq-width':
                        updateColumnWidth(2, value);
                        break;
                    case 'endtime-width':
                        updateColumnWidth(3, value);
                        break;
                    case 'qrcode-width':
                        updateColumnWidth(4, value);
                        break;
                    case 'mobile-width':
                        updateColumnWidth(5, value);
                        break;
                    case 'clash-width':
                        updateColumnWidth(6, value);
                        break;
                    case 'addtime-width':
                        updateColumnWidth(7, value);
                        break;
                    case 'endtime2-width':
                        updateColumnWidth(8, value);
                        break;
                    case 'apple-width':
                        updateColumnWidth(9, value);
                        break;
                    case 'clashcount-width':
                        updateColumnWidth(10, value);
                        break;
                    case 'online-width':
                        updateColumnWidth(11, value);
                        break;
                    case 'maxdevices-width':
                        updateColumnWidth(12, value);
                        break;
                    case 'action-width':
                        updateActionColumnWidth(value);
                        break;
                }
            });

            // è®¾ç½®æœ€å¤§è®¾å¤‡æ•°å¤±ç„¦è‡ªåŠ¨ä¿å­˜å¹¶æœ‰æç¤º
            $(function(){
                $('.setdrivers-input').blur(function(){
                    var id = $(this).data('id');
                    var val = $(this).val();
                    $.ajax({
                        url: "{:U('Admin/Dingyue/editSetdrivers')}",
                        type: 'post',
                        data: {id: id, setdrivers: val},
                        success: function(res){
                            if(window.layer){
                                layer.msg(res && res.info ? res.info : 'å·²ä¿å­˜');
                            }
                        }
                    });
                });
            });
            // ä¸€é”®æ¸…ç†æ‰€æœ‰åœ¨çº¿è®¾å¤‡æ•°æŒ‰é’®äº‹ä»¶
            $('#clean-all-drivers-btn').click(function(){
                layer.confirm('ç¡®å®šè¦æ¸…ç†æ‰€æœ‰åœ¨çº¿è®¾å¤‡æ•°å—ï¼Ÿ', {icon: 3, title:'æç¤º'}, function(index){
                    $.post('{:U("Admin/Dingyue/cleanAllDrivers")}', {}, function(res){
                        layer.msg(res.info, {icon: res.status==1?1:2, time: 1500}, function(){
                            if(res.status==1){location.reload();}
                        });
                    }, 'json');
                    layer.close(index);
                });
            });
            // æ¸…ç†åœ¨çº¿è®¾å¤‡æ•°æŒ‰é’®äº‹ä»¶
            $(document).on('click', '.clean-drivers-btn', function(){
                var id = $(this).data('id');
                layer.confirm('ç¡®å®šè¦æ¸…ç†è¯¥è´¦å·ä¸‹æ‰€æœ‰åœ¨çº¿è®¾å¤‡è®°å½•å—ï¼Ÿ', {icon: 3, title:'æç¤º'}, function(index){
                    $.post('{:U("Admin/Dingyue/cleanDrivers")}', {id: id}, function(res){
                        layer.msg(res.info, {icon: res.status==1?1:2, time: 1500}, function(){
                            if(res.status==1){location.reload();}
                        });
                    }, 'json');
                    layer.close(index);
                });
            });

            // æ‰‹æœºç«¯æ¿€æ´»æŒ‰é’®äº‹ä»¶
            $(document).on('click', '.mobile-activate-btn', function(){
                var id = $(this).data('id');
                layer.confirm('ç¡®å®šè¦æ¿€æ´»è¯¥è´¦å·å—ï¼Ÿ', {icon: 3, title:'æç¤º'}, function(index){
                    $.post('{:U("Admin/Dingyue/allEnable")}', {id: [id]}, function(res){
                        layer.msg('æ¿€æ´»æˆåŠŸ', {icon: 1, time: 1500}, function(){
                            location.reload();
                        });
                    }, 'json');
                    layer.close(index);
                });
            });

            // é€‰é¡¹å¡ç‚¹å‡»äº‹ä»¶å¤„ç†
            $('.nav-tabs .nav-link').click(function(e){
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                $('.nav-tabs .nav-link').removeClass('active');
                // æ·»åŠ å½“å‰ç‚¹å‡»é¡¹çš„æ´»åŠ¨çŠ¶æ€
                $(this).addClass('active');

                // æ›´æ–°é¡µé¢å¯¼èˆªè·¯å¾„
                var tabText = $(this).text();
                updatePageNavigation(tabText);
            });

            // æ›´æ–°é¡µé¢å¯¼èˆªè·¯å¾„å‡½æ•°
            function updatePageNavigation(currentTab) {
                var navigationHtml = `
                    <a href="{:U('Admin/Index/index')}" class="nav-item">
                        <i class="fa fa-home"></i>
                        é¦–é¡µ
                    </a>
                    <div class="nav-separator">/</div>
                    <a href="{:U('Admin/Index/index')}" class="nav-item">
                        åå°ç®¡ç†
                    </a>
                    <div class="nav-separator">/</div>
                    <div class="nav-item active">
                        è®¢é˜…ç®¡ç†
                    </div>
                    <div class="nav-separator">/</div>
                    <div class="nav-item active">
                        ${currentTab}
                    </div>
                `;
                $('.page-navigation').html(navigationHtml);
            }
        })
    </script>
            </div>
        </div>
    </div>
</block>
