<extend name="Public:base" />
<block name="title">ç”¨æˆ·è¯¦æƒ… - {$data.qq}</block>
<block name="content">
    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">
                    <i class="fa fa-home"></i>
                    é¦–é¡µ
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">
                    åå°ç®¡ç†
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Dingyue/list')}">
                    è®¢é˜…åˆ—è¡¨
                </a>
            </li>
            <li class="breadcrumb-item active">
                ç”¨æˆ·è¯¦æƒ…
            </li>
        </ol>
    </nav>

    <!-- é¡µé¢å¯¼èˆªè·¯å¾„ -->
    <div class="page-navigation">
        <a href="{:U('Admin/Index/index')}" class="nav-item">
            <i class="fa fa-home"></i>
            é¦–é¡µ
        </a>
        <div class="nav-separator">/</div>
        <a href="{:U('Admin/Index/index')}" class="nav-item">
            åå°ç®¡ç†
        </a>
        <div class="nav-separator">/</div>
        <a href="{:U('Admin/Dingyue/list')}" class="nav-item">
            è®¢é˜…ç®¡ç†
        </a>
        <div class="nav-separator">/</div>
        <div class="nav-item active">
            ç”¨æˆ·è¯¦æƒ…
        </div>
    </div>

    <div class="page-content">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-start">
                    <ul class="nav nav-tabs border-0">
                        <li class="nav-item">
                            <a class="nav-link" href="{:U('Admin/Dingyue/list')}">è®¢é˜…åˆ—è¡¨</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{:U('Admin/Dingyue/add')}">æ·»åŠ è®¢é˜…</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <style>
                    .user-detail-container {
                        background: #fff;
                        border-radius: 8px;
                        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                        margin-bottom: 20px;
                    }

                    .detail-header {
                        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
                        color: white;
                        padding: 20px;
                        border-radius: 8px 8px 0 0;
                        text-align: center;
                    }

                    .detail-header h2 {
                        margin: 0;
                        font-size: 28px;
                        font-weight: 600;
                    }

                    .detail-header .status-badge {
                        display: inline-block;
                        padding: 8px 16px;
                        border-radius: 20px;
                        font-size: 14px;
                        margin-top: 8px;
                        background: rgba(255, 255, 255, 0.2);
                    }

                    .detail-content {
                        padding: 20px;
                    }

                    .info-section {
                        margin-bottom: 30px;
                    }

                    .section-title {
                        font-size: 20px;
                        font-weight: bold;
                        color: #333;
                        margin-bottom: 15px;
                        padding-bottom: 8px;
                        border-bottom: 2px solid #f0f0f0;
                    }

                    .info-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 20px;
                    }

                    .info-item {
                        display: flex;
                        align-items: center;
                        padding: 12px;
                        background: #f8f9fa;
                        border-radius: 6px;
                        border-left: 4px solid #007bff;
                    }

                    .info-label {
                        font-weight: bold;
                        color: #333;
                        min-width: 120px;
                        margin-right: 10px;
                        font-size: 16px;
                    }

                    .info-value {
                        flex: 1;
                        color: #333;
                        font-size: 16px;
                    }

                    .qrcode-container {
                        text-align: center;
                        padding: 20px;
                        background: #f8f9fa;
                        border-radius: 6px;
                        margin: 20px 0;
                    }

                    .qrcode-container img {
                        max-width: 200px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                    }

                    .subscription-urls {
                        background: #f8f9fa;
                        padding: 15px;
                        border-radius: 6px;
                        margin: 15px 0;
                    }

                    .url-item {
                        margin-bottom: 10px;
                        padding: 8px;
                        background: white;
                        border-radius: 4px;
                        border: 1px solid #e0e0e0;
                    }

                    .url-label {
                        font-weight: bold;
                        color: #666;
                        display: block;
                        margin-bottom: 5px;
                    }

                    .url-value {
                        word-break: break-all;
                        color: #428bca;
                    }

                    /* å®¢æˆ·åå°åŠŸèƒ½æ¨¡å—æ ·å¼ */
                    .client-backend-modules {
                        margin-top: 30px;
                    }

                    .module-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 20px;
                        margin-bottom: 30px;
                    }

                    .module-card {
                        background: #fff;
                        border-radius: 8px;
                        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                        overflow: hidden;
                        transition: transform 0.3s ease;
                    }

                    .module-card:hover {
                        transform: translateY(-2px);
                    }

                    .module-header {
                        padding: 15px 20px;
                        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
                        color: white;
                        font-weight: bold;
                        font-size: 16px;
                    }

                    .module-content {
                        padding: 20px;
                    }

                    .module-item {
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                        padding: 10px 0;
                        border-bottom: 1px solid #f0f0f0;
                    }

                    .module-item:last-child {
                        border-bottom: none;
                    }

                    .module-label {
                        font-weight: 500;
                        color: #555;
                    }

                    .module-value {
                        color: #333;
                        word-break: break-all;
                        max-width: 200px;
                    }

                    .btn-group {
                        display: flex;
                        gap: 8px;
                        flex-wrap: wrap;
                    }

                    .btn-custom {
                        padding: 6px 12px;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 12px;
                        transition: all 0.3s ease;
                        text-decoration: none;
                        display: inline-block;
                    }

                    .btn-primary {
                        background: #007bff;
                        color: white;
                    }

                    .btn-primary:hover {
                        background: #0056b3;
                    }

                    .btn-success {
                        background: #28a745;
                        color: white;
                    }

                    .btn-success:hover {
                        background: #1e7e34;
                    }

                    .btn-warning {
                        background: #ffc107;
                        color: #212529;
                    }

                    .btn-warning:hover {
                        background: #e0a800;
                    }

                    .btn-info {
                        background: #17a2b8;
                        color: white;
                    }

                    .btn-info:hover {
                        background: #117a8b;
                    }

                    .copy-btn {
                        background: #6c757d;
                        color: white;
                        border: none;
                        padding: 4px 8px;
                        border-radius: 3px;
                        cursor: pointer;
                        font-size: 11px;
                    }

                    .copy-btn:hover {
                        background: #545b62;
                    }

                    .qr-display {
                        text-align: center;
                        margin: 15px 0;
                    }

                    .qr-display img {
                        max-width: 150px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                    }

                    .download-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                        gap: 10px;
                    }

                    .download-item {
                        text-align: center;
                        padding: 10px;
                        background: #f8f9fa;
                        border-radius: 6px;
                        border: 1px solid #e9ecef;
                    }

                    .download-icon {
                        font-size: 24px;
                        margin-bottom: 8px;
                        display: block;
                    }

                    .stats-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                        gap: 15px;
                    }

                    .stat-item {
                        text-align: center;
                        padding: 15px;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        color: white;
                        border-radius: 8px;
                    }

                    .stat-number {
                        font-size: 24px;
                        font-weight: bold;
                        display: block;
                    }

                    .stat-label {
                        font-size: 12px;
                        opacity: 0.9;
                    }

                    .toast {
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #28a745;
                        color: white;
                        padding: 12px 20px;
                        border-radius: 4px;
                        z-index: 9999;
                        display: none;
                    }

                    /* å“åº”å¼è®¾è®¡ */
                    /* å®¢æˆ·åå°åŠŸèƒ½æ¨¡å—æ ·å¼ */
                    .client-backend-modules {
                        margin: 30px 0;
                        padding: 20px;
                        background: #f8f9fa;
                        border-radius: 8px;
                        border: 1px solid #e9ecef;
                    }

                    .section-title {
                        font-size: 18px;
                        font-weight: bold;
                        color: #495057;
                        margin-bottom: 20px;
                        padding-bottom: 10px;
                        border-bottom: 2px solid #007bff;
                    }

                    .section-title i {
                        margin-right: 8px;
                        color: #007bff;
                    }

                    .module-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 20px;
                    }

                    .module-card {
                        background: white;
                        border-radius: 8px;
                        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                        overflow: hidden;
                        transition: transform 0.2s ease, box-shadow 0.2s ease;
                    }

                    .module-card:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
                    }

                    .module-header {
                        background: linear-gradient(135deg, #007bff, #0056b3);
                        color: white;
                        padding: 15px;
                        font-weight: bold;
                        font-size: 16px;
                    }

                    .module-header i {
                        margin-right: 8px;
                    }

                    .module-content {
                        padding: 20px;
                    }

                    .module-item {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 15px;
                        padding: 10px;
                        background: #f8f9fa;
                        border-radius: 6px;
                    }

                    .module-item:last-child {
                        margin-bottom: 0;
                    }

                    .module-label {
                        font-weight: 500;
                        color: #495057;
                        flex: 1;
                    }

                    .btn-group {
                        display: flex;
                        gap: 8px;
                    }

                    .download-grid {
                        display: grid;
                        grid-template-columns: repeat(2, 1fr);
                        gap: 15px;
                    }

                    .download-item {
                        text-align: center;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 8px;
                        transition: background-color 0.2s ease;
                    }

                    .download-item:hover {
                        background: #e9ecef;
                    }

                    .download-icon {
                        font-size: 24px;
                        display: block;
                        margin-bottom: 8px;
                    }

                    .stats-grid {
                        display: grid;
                        grid-template-columns: repeat(3, 1fr);
                        gap: 15px;
                    }

                    .stat-item {
                        text-align: center;
                        padding: 15px;
                        background: #f8f9fa;
                        border-radius: 8px;
                    }

                    .stat-number {
                        display: block;
                        font-size: 24px;
                        font-weight: bold;
                        color: #007bff;
                        margin-bottom: 5px;
                    }

                    .stat-label {
                        font-size: 12px;
                        color: #6c757d;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                    }

                    .qr-display {
                        text-align: center;
                        margin-top: 15px;
                        padding: 15px;
                        background: white;
                        border-radius: 8px;
                        border: 1px solid #dee2e6;
                    }

                    .qr-display img {
                        max-width: 120px;
                        height: auto;
                    }

                    @media (max-width: 768px) {
                        .module-grid {
                            grid-template-columns: 1fr;
                        }

                        .info-grid {
                            grid-template-columns: 1fr;
                        }

                        .download-grid {
                            grid-template-columns: repeat(2, 1fr);
                        }

                        .stats-grid {
                            grid-template-columns: repeat(2, 1fr);
                        }

                        .btn-group {
                            justify-content: center;
                        }

                        .module-item {
                            flex-direction: column;
                            align-items: flex-start;
                            gap: 10px;
                        }

                        .btn-group {
                            width: 100%;
                            justify-content: space-between;
                        }
                    }

                    font-family: monospace;
                    font-size: 12px;
                    }

                    .action-buttons {
                        display: flex;
                        flex-wrap: wrap;
                        gap: 10px;
                        margin-top: 20px;
                        padding-top: 20px;
                        border-top: 1px solid #e0e0e0;
                    }

                    .btn-custom {
                        padding: 8px 16px;
                        border-radius: 4px;
                        text-decoration: none;
                        font-size: 14px;
                        transition: all 0.3s ease;
                    }

                    .remaining-days {
                        font-size: 16px;
                        font-weight: bold;
                        padding: 8px 16px;
                        border-radius: 20px;
                        display: inline-block;
                        margin-top: 10px;
                    }

                    .remaining-days.warning {
                        background: #fff3cd;
                        color: #856404;
                        border: 1px solid #ffeaa7;
                    }

                    .remaining-days.danger {
                        background: #f8d7da;
                        color: #721c24;
                        border: 1px solid #f5c6cb;
                    }

                    .remaining-days.success {
                        background: #d4edda;
                        color: #155724;
                        border: 1px solid #c3e6cb;
                    }

                    @media (max-width: 768px) {
                        .info-grid {
                            grid-template-columns: 1fr;
                        }

                        .action-buttons {
                            flex-direction: column;
                        }

                        .btn-custom {
                            text-align: center;
                        }
                    }
                </style>

                <div class="page-header">
                    <h1><i class="fa fa-home"></i> é¦–é¡µ &gt; åå°ç®¡ç† &gt; è®¢é˜…åˆ—è¡¨ &gt; ç”¨æˆ·è¯¦æƒ…</h1>
                </div>

                <div class="col-xs-12">
                    <div class="user-detail-container">
                        <div class="detail-header">
                            <h2>ç”¨æˆ·è¯¦æƒ… - {$data.qq}</h2>
                            <span class="status-badge">
                                è´¦å·çŠ¶æ€ï¼š{$data.status_text} | é‚®ä»¶çŠ¶æ€ï¼š{$data.ispush_text}
                            </span>
                            <if condition="$data.remaining_days gt 0">
                                <div
                                    class="remaining-days <if condition='$data.remaining_days lt 7'>danger<elseif condition='$data.remaining_days lt 30'/>warning<else/>success</if>">
                                    å‰©ä½™å¤©æ•°ï¼š{$data.remaining_days} å¤©
                                </div>
                                <elseif condition="$data.endtime eq 'æ°¸ä¹…'" />
                                <div class="remaining-days success">
                                    æ°¸ä¹…è®¢é˜…
                                </div>
                                <else />
                                <div class="remaining-days danger">
                                    è®¢é˜…å·²è¿‡æœŸ
                                </div>
                            </if>
                        </div>

                        <div class="detail-content">
                            <!-- åŸºæœ¬ä¿¡æ¯ -->
                            <div class="info-section">
                                <div class="section-title"><i class="fa fa-user"></i> åŸºæœ¬ä¿¡æ¯</div>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <span class="info-label">QQå·ç ï¼š</span>
                                        <span class="info-value">{$data.qq}</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">æ·»åŠ æ—¶é—´ï¼š</span>
                                        <span class="info-value">{$data.addtime}</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">åˆ°æœŸæ—¶é—´ï¼š</span>
                                        <span class="info-value">{$data.endtime}</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">è´¦å·çŠ¶æ€ï¼š</span>
                                        <span class="info-value">
                                            <if condition="$data.status eq 1">
                                                <span style="color: #28a745;">âœ“ å¯ç”¨</span>
                                                <else />
                                                <span style="color: #dc3545;">âœ— ç¦ç”¨</span>
                                            </if>
                                        </span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">é‚®ä»¶çŠ¶æ€ï¼š</span>
                                        <span class="info-value">
                                            <if condition="$data.ispush eq 1">
                                                <span style="color: #28a745;">âœ“ å·²å‘é€</span>
                                                <else />
                                                <span style="color: #dc3545;">âœ— æœªå‘é€</span>
                                            </if>
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <!-- ä½¿ç”¨ç»Ÿè®¡ -->
                            <div class="info-section">
                                <div class="section-title"><i class="fa fa-bar-chart"></i> ä½¿ç”¨ç»Ÿè®¡</div>
                                <div class="info-grid">
                                    <div class="info-item">
                                        <span class="info-label">è¯·æ±‚æ¬¡æ•°ï¼š</span>
                                        <span class="info-value">{$data.count}</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="info-label">Clashè¯·æ±‚æ¬¡æ•°ï¼š</span>
                                        <span class="info-value">{$data.clashcount}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- è®¢é˜…åœ°å€ -->
                            <div class="info-section">
                                <div class="section-title"><i class="fa fa-link"></i> è®¢é˜…åœ°å€</div>
                                <div class="subscription-urls">
                                    <div class="url-item">
                                        <span class="url-label">æ‰‹æœºè®¢é˜…åœ°å€ï¼š</span>
                                        <div class="url-value">{$data.mobileshorturl}</div>
                                    </div>
                                    <div class="url-item">
                                        <span class="url-label">Clashè®¢é˜…åœ°å€ï¼š</span>
                                        <div class="url-value">{$data.clashshorturl}</div>
                                    </div>
                                </div>
                            </div>

                            <!-- äºŒç»´ç  -->
                            <div class="info-section">
                                <div class="section-title"><i class="fa fa-qrcode"></i> è®¢é˜…äºŒç»´ç </div>
                                <div class="qrcode-container">
                                    <img src="data:image/png;base64,{$data.qrcodeUrl}" alt="è®¢é˜…äºŒç»´ç " />
                                    <p style="margin-top: 10px; color: #666;">æ‰«æäºŒç»´ç å¿«é€Ÿè®¢é˜…</p>
                                </div>
                            </div>

                            <!-- ç”¨æˆ·è´¦å·ä¿¡æ¯ -->
                            <if condition="isset($data['user_info'])">
                                <div class="info-section">
                                    <div class="section-title"><i class="fa fa-user-circle"></i> è´¦å·ä¿¡æ¯</div>
                                    <div class="info-grid">
                                        <div class="info-item">
                                            <span class="info-label">ç”¨æˆ·åï¼š</span>
                                            <span class="info-value">{$data.user_info.username}</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">é‚®ç®±ï¼š</span>
                                            <span class="info-value">{$data.user_info.email|default='æœªè®¾ç½®'}</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">æ³¨å†Œæ—¶é—´ï¼š</span>
                                            <span class="info-value">{$data.user_info.regtime}</span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">æœ€åç™»å½•ï¼š</span>
                                            <span class="info-value">{$data.user_info.lastlogintime}</span>
                                        </div>
                                    </div>
                                </div>
                            </if>

                            <!-- å®¢æˆ·åå°åŠŸèƒ½æ¨¡å— -->
                            <div class="client-backend-modules">
                                <div class="section-title"><i class="fa fa-dashboard"></i> å®¢æˆ·åå°åŠŸèƒ½</div>

                                <div class="module-grid">
                                    <!-- è®¢é˜…ç®¡ç†æ¨¡å— -->
                                    <div class="module-card">
                                        <div class="module-header">
                                            <i class="fa fa-link"></i> è®¢é˜…ç®¡ç†
                                        </div>
                                        <div class="module-content">
                                            <div class="module-item">
                                                <span class="module-label">æ‰‹æœºè®¢é˜…åœ°å€</span>
                                                <div class="btn-group">
                                                    <button class="copy-btn"
                                                        onclick="copyToClipboard('{$data.mobileshorturl}')">å¤åˆ¶</button>
                                                    <a href="sub://{$data.mobileshorturl|base64_encode}"
                                                        class="btn-custom btn-primary">ä¸€é”®å¯¼å…¥</a>
                                                </div>
                                            </div>
                                            <div class="module-item">
                                                <span class="module-label">Clashè®¢é˜…åœ°å€</span>
                                                <div class="btn-group">
                                                    <button class="copy-btn"
                                                        onclick="copyToClipboard('{$data.clashshorturl}')">å¤åˆ¶</button>
                                                    <a href="clash://install-config?url={$data.clashshorturl|urlencode}"
                                                        class="btn-custom btn-primary">ä¸€é”®å¯¼å…¥</a>
                                                </div>
                                            </div>
                                            <div class="qr-display">
                                                <img src="data:image/png;base64,{$data.qrcodeUrl}" alt="è®¢é˜…äºŒç»´ç " />
                                                <div style="font-size: 12px; color: #666; margin-top: 5px;">æ‰«ç è®¢é˜…</div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- å®¢æˆ·ç«¯ä¸‹è½½æ¨¡å— -->
                                    <div class="module-card">
                                        <div class="module-header">
                                            <i class="fa fa-download"></i> å®¢æˆ·ç«¯ä¸‹è½½
                                        </div>
                                        <div class="module-content">
                                            <div class="download-grid">
                                                <div class="download-item">
                                                    <span class="download-icon">ğŸ–¥ï¸</span>
                                                    <div style="font-size: 12px; font-weight: bold;">Windows</div>
                                                    <a href="#" class="btn-custom btn-info"
                                                        style="font-size: 10px; padding: 4px 8px; margin-top: 5px;">ä¸‹è½½</a>
                                                </div>
                                                <div class="download-item">
                                                    <span class="download-icon">ğŸ“±</span>
                                                    <div style="font-size: 12px; font-weight: bold;">Android</div>
                                                    <a href="#" class="btn-custom btn-info"
                                                        style="font-size: 10px; padding: 4px 8px; margin-top: 5px;">ä¸‹è½½</a>
                                                </div>
                                                <div class="download-item">
                                                    <span class="download-icon">ğŸ</span>
                                                    <div style="font-size: 12px; font-weight: bold;">Mac</div>
                                                    <a href="#" class="btn-custom btn-info"
                                                        style="font-size: 10px; padding: 4px 8px; margin-top: 5px;">ä¸‹è½½</a>
                                                </div>
                                                <div class="download-item">
                                                    <span class="download-icon">ğŸ“²</span>
                                                    <div style="font-size: 12px; font-weight: bold;">iOS</div>
                                                    <a href="#" class="btn-custom btn-info"
                                                        style="font-size: 10px; padding: 4px 8px; margin-top: 5px;">ä¸‹è½½</a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- è´¦å·ç®¡ç†æ¨¡å— -->
                                    <div class="module-card">
                                        <div class="module-header">
                                            <i class="fa fa-user-cog"></i> è´¦å·ç®¡ç†
                                        </div>
                                        <div class="module-content">
                                            <div class="module-item">
                                                <span class="module-label">é‡ç½®å¯†ç </span>
                                                <button class="btn-custom btn-warning"
                                                    onclick="resetUserPassword()">é‡ç½®</button>
                                            </div>
                                            <div class="module-item">
                                                <span class="module-label">è´¦å·è®¾ç½®</span>
                                                <button class="btn-custom btn-info"
                                                    onclick="openAccountSettings()">è®¾ç½®</button>
                                            </div>
                                            <div class="module-item">
                                                <span class="module-label">ç™»å½•ç”¨æˆ·åå°</span>
                                                <a href="{:U('Admin/Dingyue/loginAsUser',array('id'=>$data['id']))}"
                                                    class="btn-custom btn-success" target="_blank">ç™»å½•</a>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- ä½¿ç”¨ç»Ÿè®¡æ¨¡å— -->
                                    <div class="module-card">
                                        <div class="module-header">
                                            <i class="fa fa-chart-bar"></i> ä½¿ç”¨ç»Ÿè®¡
                                        </div>
                                        <div class="module-content">
                                            <div class="stats-grid">
                                                <div class="stat-item">
                                                    <span class="stat-number">{$data.count}</span>
                                                    <span class="stat-label">æ€»è¯·æ±‚æ¬¡æ•°</span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-number">{$data.clashcount}</span>
                                                    <span class="stat-label">Clashè¯·æ±‚æ¬¡æ•°</span>
                                                </div>
                                                <div class="stat-item">
                                                    <span class="stat-number">{$data.remaining_days|default=0}</span>
                                                    <span class="stat-label">å‰©ä½™å¤©æ•°</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- æ“ä½œæŒ‰é’® -->
                            <div class="action-buttons">
                                <a href="{:U('Admin/Dingyue/list')}" class="btn btn-default btn-custom">
                                    <i class="fa fa-arrow-left"></i> è¿”å›åˆ—è¡¨
                                </a>
                                <a href="{:U('Admin/Dingyue/edit',array('id'=>$data['id']))}"
                                    class="btn btn-warning btn-custom">
                                    <i class="fa fa-edit"></i> ä¿®æ”¹è®¢é˜…
                                </a>
                                <a href="{:U('Admin/Dingyue/sendmail',array('id'=>$data['id']))}"
                                    class="btn btn-info btn-custom">
                                    <i class="fa fa-envelope"></i> å‘é€é‚®ä»¶
                                </a>
                                <a href="{:U('Admin/Dingyue/resetSubscription',array('id'=>$data['id']))}"
                                    class="btn btn-primary btn-custom" onclick="return confirm('ç¡®å®šé‡ç½®è¯¥ç”¨æˆ·çš„è®¢é˜…åœ°å€å—ï¼Ÿ');">
                                    <i class="fa fa-refresh"></i> é‡ç½®è®¢é˜…åœ°å€
                                </a>
                                <a href="{:U('Admin/Dingyue/loginAsUser',array('id'=>$data['id']))}"
                                    class="btn btn-success btn-custom" target="_blank">
                                    <i class="fa fa-sign-in"></i> è¿›å…¥ç”¨æˆ·åå°
                                </a>
                                <if condition="isset($data['user_info'])">
                                    <a href="{:U('Admin/Customer/edit',array('id'=>$data.user_info.id))}"
                                        class="btn btn-warning btn-custom">
                                        <i class="fa fa-user-edit"></i> ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯
                                    </a>
                                    <a href="javascript:void(0);" class="btn btn-secondary btn-custom"
                                        onclick="resetPassword()">
                                        <i class="fa fa-key"></i> é‡ç½®å¯†ç 
                                    </a>
                                    <if condition="$data.user_info.status eq 1">
                                        <a href="javascript:void(0);" class="btn btn-warning btn-custom"
                                            onclick="toggleUserStatus(0)">
                                            <i class="fa fa-ban"></i> ç¦ç”¨è´¦å·
                                        </a>
                                        <else />
                                        <a href="javascript:void(0);" class="btn btn-success btn-custom"
                                            onclick="toggleUserStatus(1)">
                                            <i class="fa fa-check"></i> å¯ç”¨è´¦å·
                                        </a>
                                    </if>
                                </if>
                                <a href="{:U('Admin/Dingyue/del',array('id'=>$data['id']))}"
                                    class="btn btn-danger btn-custom" onclick="return confirm('ç¡®å®šåˆ é™¤è¯¥ç”¨æˆ·çš„è®¢é˜…å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼');">
                                    <i class="fa fa-trash"></i> åˆ é™¤è®¢é˜…
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    function resetPassword() {
                        if (confirm('ç¡®å®šè¦é‡ç½®è¯¥ç”¨æˆ·çš„å¯†ç å—ï¼Ÿæ–°å¯†ç å°†å‘é€åˆ°ç”¨æˆ·é‚®ç®±ã€‚')) {
                            // è¿™é‡Œå¯ä»¥æ·»åŠ é‡ç½®å¯†ç çš„AJAXè¯·æ±‚
                            alert('å¯†ç é‡ç½®åŠŸèƒ½éœ€è¦åœ¨åç«¯å®ç°');
                        }
                    }

                    function toggleUserStatus(status) {
                        var action = status == 1 ? 'å¯ç”¨' : 'ç¦ç”¨';
                        if (confirm('ç¡®å®šè¦' + action + 'è¯¥ç”¨æˆ·è´¦å·å—ï¼Ÿ')) {
                            // è¿™é‡Œå¯ä»¥æ·»åŠ åˆ‡æ¢ç”¨æˆ·çŠ¶æ€çš„AJAXè¯·æ±‚
                            alert('ç”¨æˆ·çŠ¶æ€åˆ‡æ¢åŠŸèƒ½éœ€è¦åœ¨åç«¯å®ç°');
                        }
                    }

                    // é€šç”¨å¤åˆ¶åˆ°å‰ªè´´æ¿å‡½æ•°
                    function copyToClipboard(text) {
                        if (navigator.clipboard) {
                            navigator.clipboard.writeText(text).then(function () {
                                showToast('å¤åˆ¶æˆåŠŸï¼');
                            }, function (err) {
                                console.error('å¤åˆ¶å¤±è´¥: ', err);
                                fallbackCopyTextToClipboard(text);
                            });
                        } else {
                            fallbackCopyTextToClipboard(text);
                        }
                    }

                    function fallbackCopyTextToClipboard(text) {
                        var textArea = document.createElement("textarea");
                        textArea.value = text;
                        textArea.style.top = "0";
                        textArea.style.left = "0";
                        textArea.style.position = "fixed";
                        document.body.appendChild(textArea);
                        textArea.focus();
                        textArea.select();

                        try {
                            var successful = document.execCommand('copy');
                            if (successful) {
                                showToast('å¤åˆ¶æˆåŠŸï¼');
                            } else {
                                showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                            }
                        } catch (err) {
                            console.error('å¤åˆ¶å¤±è´¥: ', err);
                            showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                        }

                        document.body.removeChild(textArea);
                    }

                    // æ˜¾ç¤ºæç¤ºæ¡†
                    function showToast(message) {
                        // åˆ›å»ºæç¤ºæ¡†å…ƒç´ 
                        var toast = document.createElement('div');
                        toast.textContent = message;
                        toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #28a745;
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            z-index: 9999;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        `;

                        document.body.appendChild(toast);

                        // 3ç§’åè‡ªåŠ¨ç§»é™¤
                        setTimeout(function () {
                            if (toast.parentNode) {
                                toast.parentNode.removeChild(toast);
                            }
                        }, 3000);
                    }

                    // é‡ç½®ç”¨æˆ·å¯†ç 
                    function resetUserPassword() {
                        if (confirm('ç¡®å®šè¦é‡ç½®è¯¥ç”¨æˆ·çš„å¯†ç å—ï¼Ÿé‡ç½®åå°†ç”Ÿæˆæ–°çš„éšæœºå¯†ç ã€‚')) {
                            showToast('å¯†ç é‡ç½®åŠŸèƒ½éœ€è¦åç«¯æ”¯æŒ');
                        }
                    }

                    // è´¦å·è®¾ç½®
                    function openAccountSettings() {
                        showToast('è´¦å·è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­...');
                    }

                    // å¤åˆ¶è®¢é˜…åœ°å€åŠŸèƒ½
                    document.addEventListener('click', function (e) {
                        if (e.target.classList.contains('url-value')) {
                            var text = e.target.textContent;
                            copyToClipboard(text);
                        }
                    });
                </script>
            </div>
        </div>
    </div>
</block>