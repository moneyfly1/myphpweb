<extend name="Public:base" />
<block name="title">用户操作日志 - {$user.username}</block>
<block name="content">
    <style>
        /* 面包屑导航设计 */
        .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
        }
        
        .breadcrumb-item a {
            color: #1677ff;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: color 0.3s ease;
        }
        
        .breadcrumb-item a:hover {
            color: #0958d9;
            text-decoration: none;
        }
        
        .breadcrumb-item.active {
            color: #8c8c8c;
        }
        
        .breadcrumb-item i {
            font-size: 14px;
        }
        
        .breadcrumb-item:not(:last-child)::after {
            content: '/';
            color: #d9d9d9;
            margin-left: 8px;
            font-size: 12px;
        }
        
        /* 页面导航路径 */
        .page-navigation {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .page-navigation .nav-item {
            display: flex;
            align-items: center;
            color: #6c757d;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .page-navigation .nav-item:hover {
            color: #1677ff;
            text-decoration: none;
        }
        
        .page-navigation .nav-item.active {
            color: #1677ff;
            font-weight: 500;
        }
        
        .page-navigation .nav-separator {
            color: #dee2e6;
            margin: 0 4px;
        }
        
        /* 卡片样式 */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
        }
        
        .card-header {
            background: #fafafa;
            border-bottom: 1px solid #f0f0f0;
            padding: 16px 20px;
            font-weight: 500;
        }
        
        /* 用户信息卡片 */
        .user-info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .user-info-card h3 {
            margin: 0 0 10px 0;
            font-size: 24px;
            font-weight: 600;
        }
        
        .user-info-card .user-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .user-info-card .detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .user-info-card .detail-label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 4px;
        }
        
        .user-info-card .detail-value {
            font-size: 16px;
            font-weight: 500;
        }
        
        /* 选项卡样式 */
        .nav-tabs {
            border-bottom: none;
            margin-bottom: 20px;
            background: transparent;
            display: flex;
            flex-direction: row;
            align-items: center;
        }
        
        .nav-tabs .nav-item {
            margin-right: 8px;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #595959;
            padding: 12px 20px;
            border-radius: 6px;
            background: #f5f5f5;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .nav-tabs .nav-link.active {
            background: #1677ff;
            color: white;
            border: none;
            box-shadow: 0 2px 8px rgba(22, 119, 255, 0.3);
        }
        
        .nav-tabs .nav-link:hover {
            background: #e6f7ff;
            color: #1677ff;
            transform: translateY(-1px);
        }
        
        /* 表格样式 */
        .table-responsive {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .table {
            margin: 0;
            font-size: 14px;
        }
        
        .table th {
            background-color: #fafafa;
            font-weight: 500;
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .table td {
            padding: 16px;
            vertical-align: middle;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(22, 119, 255, 0.05);
        }
        
        /* 日志类型标签 */
        .log-type {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
            min-width: 80px;
        }
        
        .log-type.action {
            background: #e6f7ff;
            color: #1677ff;
        }
        
        .log-type.subscription {
            background: #f6ffed;
            color: #52c41a;
        }
        
        .log-type.device {
            background: #fff7e6;
            color: #fa8c16;
        }
        
        /* 空状态样式 */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #8c8c8c;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-state h4 {
            margin: 0 0 8px 0;
            color: #595959;
        }
        
        .empty-state p {
            margin: 0;
            font-size: 14px;
        }
        
        /* 返回按钮 */
        .back-button {
            background: #f5f5f5;
            border: 1px solid #d9d9d9;
            color: #595959;
            padding: 8px 16px;
            border-radius: 6px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }
        
        .back-button:hover {
            background: #e6f7ff;
            border-color: #1677ff;
            color: #1677ff;
            text-decoration: none;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .user-info-card .user-details {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .nav-tabs {
                flex-direction: column;
                gap: 8px;
            }
            
            .nav-tabs .nav-item {
                margin-right: 0;
                width: 100%;
            }
            
            .nav-tabs .nav-link {
                text-align: center;
                width: 100%;
            }
            
            .table-responsive {
                font-size: 12px;
            }
            
            .table th,
            .table td {
                padding: 8px 4px;
            }
        }
    </style>
    
    <!-- 面包屑导航 -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">
                    <i class="fa fa-home"></i>
                    首页
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">
                    后台管理
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{:U('Customer/list')}">
                    用户列表
                </a>
            </li>
            <li class="breadcrumb-item active">
                操作日志 - {$user.username}
            </li>
        </ol>
    </nav>
    
    <!-- 页面导航路径 -->
    <div class="page-navigation">
        <a href="{:U('Admin/Index/index')}" class="nav-item">
            <i class="fa fa-home"></i>
            首页
        </a>
        <div class="nav-separator">/</div>
        <a href="{:U('Admin/Index/index')}" class="nav-item">
            后台管理
        </a>
        <div class="nav-separator">/</div>
        <a href="{:U('Customer/list')}" class="nav-item">
            用户列表
        </a>
        <div class="nav-separator">/</div>
        <div class="nav-item active">
            操作日志 - {$user.username}
        </div>
    </div>
    
    <!-- 返回按钮 -->
    <a href="{:U('Customer/list')}" class="back-button">
        <i class="fa fa-arrow-left"></i>
        返回用户列表
    </a>
    
    <!-- 用户信息卡片 -->
    <div class="user-info-card">
        <h3><i class="fa fa-user"></i> {$user.username}</h3>
        <div class="user-details">
            <div class="detail-item">
                <div class="detail-label">用户ID</div>
                <div class="detail-value">{$user.id}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">注册时间</div>
                <div class="detail-value">{$user.regtime_display}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">最后登录</div>
                <div class="detail-value">{$user.lasttime_display}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">账户状态</div>
                <div class="detail-value">{$user.status_display}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">激活状态</div>
                <div class="detail-value">{$user.activation_display}</div>
            </div>
        </div>
    </div>
    
    <div class="page-content">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-start">
                    <ul class="nav nav-tabs border-0" id="logTabs">
                        <li class="nav-item">
                            <a class="nav-link active" href="#actionLogs" data-toggle="tab">
                                <i class="fa fa-list-alt"></i> 操作日志
                                <span class="badge badge-light ml-1">{:count($actionLogs)}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#subscriptionHistory" data-toggle="tab">
                                <i class="fa fa-history"></i> 订阅历史
                                <span class="badge badge-light ml-1">{:count($subscriptionHistory)}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#deviceLogs" data-toggle="tab">
                                <i class="fa fa-mobile"></i> 设备日志
                                <span class="badge badge-light ml-1">{:count($deviceLogs)}</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <!-- 操作日志 -->
                    <div class="tab-pane fade show active" id="actionLogs">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th width="15%">操作类型</th>
                                        <th width="50%">操作详情</th>
                                        <th width="20%">操作时间</th>
                                        <th width="15%">操作者</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <if condition="empty($actionLogs)">
                                        <tr>
                                            <td colspan="4" class="empty-state">
                                                <i class="fa fa-inbox"></i>
                                                <h4>暂无操作日志</h4>
                                                <p>该用户还没有任何操作记录</p>
                                            </td>
                                        </tr>
                                    <else />
                                        <foreach name="actionLogs" item="log">
                                            <tr>
                                                <td>
                                                    <span class="log-type action">{$log.action}</span>
                                                </td>
                                                <td>{$log.detail}</td>
                                                <td>{$log.action_time_formatted}</td>
                                                <td>{$log.operator|default='系统'}</td>
                                            </tr>
                                        </foreach>
                                    </if>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 订阅历史 -->
                    <div class="tab-pane fade" id="subscriptionHistory">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th width="20%">变更类型</th>
                                        <th width="35%">原地址</th>
                                        <th width="35%">新地址</th>
                                        <th width="10%">变更时间</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <if condition="empty($subscriptionHistory)">
                                        <tr>
                                            <td colspan="4" class="empty-state">
                                                <i class="fa fa-history"></i>
                                                <h4>暂无订阅历史</h4>
                                                <p>该用户还没有订阅变更记录</p>
                                            </td>
                                        </tr>
                                    <else />
                                        <foreach name="subscriptionHistory" item="history">
                                            <tr>
                                                <td>
                                                    <span class="log-type subscription">{$history.change_type}</span>
                                                </td>
                                                <td>
                                                    <code>{$history.old_url}</code>
                                                </td>
                                                <td>
                                                    <code>{$history.new_url}</code>
                                                </td>
                                                <td>{$history.change_time_formatted}</td>
                                            </tr>
                                        </foreach>
                                    </if>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 设备日志 -->
                    <div class="tab-pane fade" id="deviceLogs">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th width="15%">设备类型</th>
                                        <th width="25%">设备信息</th>
                                        <th width="20%">IP地址</th>
                                        <th width="20%">最后访问</th>
                                        <th width="20%">访问次数</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <if condition="empty($deviceLogs)">
                                        <tr>
                                            <td colspan="5" class="empty-state">
                                                <i class="fa fa-mobile"></i>
                                                <h4>暂无设备日志</h4>
                                                <p>该用户还没有设备访问记录</p>
                                            </td>
                                        </tr>
                                    <else />
                                        <foreach name="deviceLogs" item="device">
                                            <tr>
                                                <td>
                                                    <span class="log-type device">{$device.ua|default='未知设备'}</span>
                                                </td>
                                                <td>
                                                    <div style="font-size: 12px;">
                                                        <div><strong>UA:</strong> {$device.ua|default='未知'}</div>
                                                        <div><strong>指纹:</strong> {$device.fingerprint|default='无'}</div>
                                                    </div>
                                                </td>
                                                <td>{$device.ip|default='未知'}</td>
                                                <td>{$device.last_seen_formatted}</td>
                                                <td>1</td>
                                            </tr>
                                        </foreach>
                                    </if>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="__PUBLIC__/statics/js/jquery-3.6.0.min.js"></script>
    <script src="__PUBLIC__/statics/bootstrap-3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        $(function () {
            // 选项卡切换
            $('#logTabs a').click(function (e) {
                e.preventDefault();
                $(this).tab('show');
            });
        });
    </script>
</block>
