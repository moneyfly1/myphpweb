<extend name="Public:base" />
<block name="title">用户操作日志 - {$user.username}</block>
<block name="content">
    
    <!-- 面包屑导航 -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">
                    <i class="fa fa-home"></i>
                    首页
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{:U('Admin/Index/index')}">
                    后台管理
                </a>
            </li>
            <li class="breadcrumb-item">
                <a href="{:U('Customer/list')}">
                    用户列表
                </a>
            </li>
            <li class="breadcrumb-item active">
                操作日志 - {$user.username}
            </li>
        </ol>
    </nav>
    
    <!-- 页面导航路径 -->
    <div class="page-navigation">
        <a href="{:U('Admin/Index/index')}" class="nav-item">
            <i class="fa fa-home"></i>
            首页
        </a>
        <div class="nav-separator">/</div>
        <a href="{:U('Admin/Index/index')}" class="nav-item">
            后台管理
        </a>
        <div class="nav-separator">/</div>
        <a href="{:U('Customer/list')}" class="nav-item">
            用户列表
        </a>
        <div class="nav-separator">/</div>
        <div class="nav-item active">
            操作日志 - {$user.username}
        </div>
    </div>
    
    <!-- 返回按钮 -->
    <a href="{:U('Customer/list')}" class="back-button">
        <i class="fa fa-arrow-left"></i>
        返回用户列表
    </a>
    
    <!-- 用户信息卡片 -->
    <div class="user-info-card">
        <h3><i class="fa fa-user"></i> {$user.username}</h3>
        <div class="user-details">
            <div class="detail-item">
                <div class="detail-label">用户ID</div>
                <div class="detail-value">{$user.id}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">注册时间</div>
                <div class="detail-value">{$user.regtime_display}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">最后登录</div>
                <div class="detail-value">{$user.lasttime_display}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">账户状态</div>
                <div class="detail-value">{$user.status_display}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">激活状态</div>
                <div class="detail-value">{$user.activation_display}</div>
            </div>
        </div>
    </div>
    
    <div class="page-content">
        <div class="card">
            <div class="card-header">
                <div class="d-flex justify-content-start">
                    <ul class="nav nav-tabs border-0" id="logTabs">
                        <li class="nav-item">
                            <a class="nav-link active" href="#actionLogs" data-toggle="tab">
                                <i class="fa fa-list-alt"></i> 操作日志
                                <span class="badge badge-light ml-1">{:count($actionLogs)}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#subscriptionHistory" data-toggle="tab">
                                <i class="fa fa-history"></i> 订阅历史
                                <span class="badge badge-light ml-1">{:count($subscriptionHistory)}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#deviceLogs" data-toggle="tab">
                                <i class="fa fa-mobile"></i> 设备日志
                                <span class="badge badge-light ml-1">{:count($deviceLogs)}</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="card-body">
                <div class="tab-content">
                    <!-- 操作日志 -->
                    <div class="tab-pane fade show active" id="actionLogs">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th width="15%">操作类型</th>
                                        <th width="50%">操作详情</th>
                                        <th width="20%">操作时间</th>
                                        <th width="15%">操作者</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <if condition="empty($actionLogs)">
                                        <tr>
                                            <td colspan="4" class="empty-state">
                                                <i class="fa fa-inbox"></i>
                                                <h4>暂无操作日志</h4>
                                                <p>该用户还没有任何操作记录</p>
                                            </td>
                                        </tr>
                                    <else />
                                        <foreach name="actionLogs" item="log">
                                            <tr>
                                                <td>
                                                    <span class="log-type action">{$log.action}</span>
                                                </td>
                                                <td>{$log.detail}</td>
                                                <td>{$log.action_time_formatted}</td>
                                                <td>{$log.operator|default='系统'}</td>
                                            </tr>
                                        </foreach>
                                    </if>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 订阅历史 -->
                    <div class="tab-pane fade" id="subscriptionHistory">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th width="20%">变更类型</th>
                                        <th width="35%">原地址</th>
                                        <th width="35%">新地址</th>
                                        <th width="10%">变更时间</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <if condition="empty($subscriptionHistory)">
                                        <tr>
                                            <td colspan="4" class="empty-state">
                                                <i class="fa fa-history"></i>
                                                <h4>暂无订阅历史</h4>
                                                <p>该用户还没有订阅变更记录</p>
                                            </td>
                                        </tr>
                                    <else />
                                        <foreach name="subscriptionHistory" item="history">
                                            <tr>
                                                <td>
                                                    <span class="log-type subscription">{$history.change_type}</span>
                                                </td>
                                                <td>
                                                    <code>{$history.old_url}</code>
                                                </td>
                                                <td>
                                                    <code>{$history.new_url}</code>
                                                </td>
                                                <td>{$history.change_time_formatted}</td>
                                            </tr>
                                        </foreach>
                                    </if>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- 设备日志 -->
                    <div class="tab-pane fade" id="deviceLogs">
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered table-hover">
                                <thead>
                                    <tr>
                                        <th width="15%">设备类型</th>
                                        <th width="25%">设备信息</th>
                                        <th width="20%">IP地址</th>
                                        <th width="20%">最后访问</th>
                                        <th width="20%">访问次数</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <if condition="empty($deviceLogs)">
                                        <tr>
                                            <td colspan="5" class="empty-state">
                                                <i class="fa fa-mobile"></i>
                                                <h4>暂无设备日志</h4>
                                                <p>该用户还没有设备访问记录</p>
                                            </td>
                                        </tr>
                                    <else />
                                        <foreach name="deviceLogs" item="device">
                                            <tr>
                                                <td>
                                                    <span class="log-type device">{$device.ua|default='未知设备'}</span>
                                                </td>
                                                <td>
                                                    <div style="font-size: 12px;">
                                                        <div><strong>UA:</strong> {$device.ua|default='未知'}</div>
                                                        <div><strong>指纹:</strong> {$device.fingerprint|default='无'}</div>
                                                    </div>
                                                </td>
                                                <td>{$device.ip|default='未知'}</td>
                                                <td>{$device.last_seen_formatted}</td>
                                                <td>1</td>
                                            </tr>
                                        </foreach>
                                    </if>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="__PUBLIC__/statics/js/jquery-3.6.0.min.js"></script>
    <script src="__PUBLIC__/statics/bootstrap-3.3.5/js/bootstrap.min.js"></script>
    <script type="text/javascript">
        $(function () {
            // 选项卡切换
            $('#logTabs a').click(function (e) {
                e.preventDefault();
                $(this).tab('show');
            });
        });
    </script>
</block>
