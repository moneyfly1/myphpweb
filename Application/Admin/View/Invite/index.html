<extend name="Public:base" />
<block name="title">邀请码管理</block>
<block name="content">
    <nav class="breadcrumb">
        <span class="breadcrumb-item"><a href="{:U('Admin/Index/index')}"><i class="fa fa-home"></i> 首页</a></span>
        <span class="breadcrumb-item active">邀请码管理</span>
    </nav>

    <div class="page-content">
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" href="{:U('Admin/Invite/index')}">邀请码列表</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{:U('Admin/Invite/relations')}">邀请关系</a>
                    </li>
                </ul>
            </div>
            <div class="card-body">
                <div class="search-bar">
                    <form method="get" action="{:U('Admin/Invite/index')}" style="display:flex;gap:10px;align-items:center;">
                        <input type="text" name="word" value="{$word}" placeholder="搜索邀请码..." class="form-control">
                        <button type="submit" class="btn btn-primary btn-sm">搜索</button>
                    </form>
                </div>

                <!-- Desktop Table -->
                <div class="desktop-table">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>邀请码</th>
                                <th>创建者</th>
                                <th>已用/上限</th>
                                <th>奖励类型</th>
                                <th>邀请人奖励</th>
                                <th>被邀请人奖励</th>
                                <th>状态</th>
                                <th>创建时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <volist name="data" id="vo">
                            <tr>
                                <td>{$vo.id}</td>
                                <td><code>{$vo.code}</code></td>
                                <td>{$vo.creator_name|default='未知'}</td>
                                <td>{$vo.used_count}/{$vo.max_uses}</td>
                                <td>{$vo.reward_type}</td>
                                <td>{$vo.inviter_reward}</td>
                                <td>{$vo.invitee_reward}</td>
                                <td>
                                    <if condition="$vo['is_active'] eq 1">
                                        <span class="status-badge status-active">启用</span>
                                    <else />
                                        <span class="status-badge status-disabled">禁用</span>
                                    </if>
                                </td>
                                <td>{$vo.created_at|date='Y-m-d H:i',###}</td>
                                <td>
                                    <div class="action-group">
                                        <button class="btn btn-xs btn-warning" onclick="toggleCode({$vo.id})">
                                            <if condition="$vo['is_active'] eq 1">禁用<else />启用</if>
                                        </button>
                                        <a class="btn btn-xs btn-danger" href="{:U('Admin/Invite/del', array('id'=>$vo['id']))}" onclick="return confirm('确定删除该邀请码？')">删除</a>
                                    </div>
                                </td>
                            </tr>
                            </volist>
                            <empty name="data">
                            <tr><td colspan="10" class="text-center text-muted" style="padding:2rem;">暂无邀请码数据</td></tr>
                            </empty>
                        </tbody>
                    </table>
                </div>
                <!-- Mobile Cards -->
                <div class="mobile-card-list">
                    <volist name="data" id="vo">
                    <div class="mobile-card">
                        <div class="card-header-row">
                            <span class="card-title"><code>{$vo.code}</code></span>
                            <if condition="$vo['is_active'] eq 1">
                                <span class="status-badge status-active">启用</span>
                            <else />
                                <span class="status-badge status-disabled">禁用</span>
                            </if>
                        </div>
                        <div class="card-row">
                            <span class="label">创建者</span>
                            <span class="value">{$vo.creator_name|default='未知'}</span>
                        </div>
                        <div class="card-row">
                            <span class="label">已用/上限</span>
                            <span class="value">{$vo.used_count}/{$vo.max_uses}</span>
                        </div>
                        <div class="card-row">
                            <span class="label">奖励类型</span>
                            <span class="value">{$vo.reward_type}</span>
                        </div>
                        <div class="card-row">
                            <span class="label">创建时间</span>
                            <span class="value">{$vo.created_at|date='Y-m-d H:i',###}</span>
                        </div>
                        <div class="card-actions">
                            <button class="btn btn-warning" onclick="toggleCode({$vo.id})">
                                <if condition="$vo['is_active'] eq 1">禁用<else />启用</if>
                            </button>
                            <a class="btn btn-danger" href="{:U('Admin/Invite/del', array('id'=>$vo['id']))}" onclick="return confirm('确定删除该邀请码？')">删除</a>
                        </div>
                    </div>
                    </volist>
                    <empty name="data">
                    <div class="mobile-empty">暂无邀请码数据</div>
                    </empty>
                </div>
                <!-- Pagination -->
                <div class="page-footer">
                    <div class="pagination-container">
                        <div class="pagination">{$page}</div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</block>
<block name="js">
<script>
function toggleCode(id) {
    $.post("{:U('Admin/Invite/toggle')}", {id: id}, function(res) {
        if (res.code == 0) {
            location.reload();
        } else {
            alert(res.msg);
        }
    }, 'json');
}
</script>
</block>
