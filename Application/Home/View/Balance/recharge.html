<extend name="Public:layout" />
<block name="title">账户充值</block>
<block name="head">
    <style>
        .recharge-page .container { max-width: 900px; margin: 0 auto; padding: var(--space-4); }
        .recharge-page .page-header { margin-bottom: var(--space-4); }
        .recharge-page .page-header h1 { margin: 0 0 var(--space-2); font-size: var(--font-size-lg); }
        .recharge-card { background: var(--color-bg); border-radius: var(--radius-lg); box-shadow: var(--shadow); margin-bottom: var(--space-4); padding: var(--space-4); }
        .recharge-card h3 { margin: 0 0 var(--space-3); display: flex; align-items: center; gap: var(--space-2); font-size: 1.1rem; }
        .amount-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-3); margin-bottom: var(--space-4); }
        .amount-item { padding: var(--space-4); border: 2px solid var(--color-border); border-radius: var(--radius-lg); text-align: center; cursor: pointer; transition: all 0.2s; background: var(--color-bg); }
        .amount-item:hover { border-color: var(--color-primary); background: rgba(22,119,255,.04); }
        .amount-item.active { border-color: var(--color-primary); background: rgba(22,119,255,.08); box-shadow: 0 0 0 3px rgba(22,119,255,.15); }
        .amount-item .value { font-size: 1.5rem; font-weight: 700; color: var(--color-text); }
        .amount-item .unit { font-size: 0.85rem; color: var(--color-text-secondary); }
        .custom-amount { margin-bottom: var(--space-4); }
        .custom-amount label { display: block; margin-bottom: var(--space-2); font-weight: 500; color: var(--color-text-secondary); font-size: 0.9rem; }
        .custom-amount input { width: 100%; padding: var(--space-3); border: 2px solid var(--color-border); border-radius: var(--radius); font-size: 1.1rem; transition: border-color 0.2s; box-sizing: border-box; }
        .custom-amount input:focus { outline: none; border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(22,119,255,.1); }
        .btn-submit { width: 100%; padding: var(--space-3); background: var(--color-primary); color: #fff; border: none; border-radius: var(--radius); font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-submit:hover { opacity: 0.9; }
        .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; }
        .notice-box { background: rgba(22,119,255,.05); border: 1px solid rgba(22,119,255,.2); border-radius: var(--radius); padding: var(--space-3); margin-top: var(--space-3); }
        .notice-box p { margin: var(--space-1) 0; color: var(--color-text-secondary); font-size: 0.85rem; line-height: 1.7; }
        .back-link { display: inline-flex; align-items: center; gap: var(--space-1); color: var(--color-primary); text-decoration: none; font-size: 0.9rem; margin-bottom: var(--space-3); }
        .back-link:hover { text-decoration: underline; }
        @media (max-width: 767px) {
            .recharge-page .container { padding: var(--space-3); }
            .amount-grid { grid-template-columns: repeat(2, 1fr); gap: var(--space-2); }
            .amount-item .value { font-size: 1.2rem; }
        }
    </style>
</block>
<block name="content">
<div class="recharge-page">
    <div class="container" style="padding-top:0;">
        <a href="{:U('Home/Balance/index')}" class="back-link"><i class="fas fa-arrow-left"></i> 返回余额</a>
        <div class="page-header">
            <h1>账户充值</h1>
            <p>当前余额：<strong style="color: var(--color-primary); font-size: 1.2rem;">&yen;{$balance}</strong></p>
        </div>

        <div class="recharge-card">
            <h3><i class="fas fa-coins"></i> 选择充值金额</h3>
            <div class="amount-grid">
                <div class="amount-item" data-amount="10" onclick="selectAmount(this, 10)">
                    <div class="value">10</div>
                    <div class="unit">元</div>
                </div>
                <div class="amount-item" data-amount="50" onclick="selectAmount(this, 50)">
                    <div class="value">50</div>
                    <div class="unit">元</div>
                </div>
                <div class="amount-item active" data-amount="100" onclick="selectAmount(this, 100)">
                    <div class="value">100</div>
                    <div class="unit">元</div>
                </div>
                <div class="amount-item" data-amount="200" onclick="selectAmount(this, 200)">
                    <div class="value">200</div>
                    <div class="unit">元</div>
                </div>
                <div class="amount-item" data-amount="500" onclick="selectAmount(this, 500)">
                    <div class="value">500</div>
                    <div class="unit">元</div>
                </div>
                <div class="amount-item" data-amount="1000" onclick="selectAmount(this, 1000)">
                    <div class="value">1000</div>
                    <div class="unit">元</div>
                </div>
            </div>
            <div class="custom-amount">
                <label>自定义金额 (最低1元，最高10000元)</label>
                <input type="number" id="amountInput" min="1" max="10000" step="0.01" placeholder="请输入充值金额" value="100">
            </div>
            <button type="button" class="btn-submit" id="payBtn" onclick="submitRecharge()">
                <i class="fab fa-alipay"></i> 支付宝充值 ¥<span id="payAmount">100.00</span>
            </button>
            <div class="notice-box">
                <p><i class="fas fa-shield-alt"></i> 充值通过支付宝安全支付，支付成功后余额自动到账</p>
                <p><i class="fas fa-info-circle"></i> 充值后可使用余额购买套餐、升级设备数量等</p>
            </div>
        </div>
    </div>
</div>
</block>
<block name="footer">
<script>
var selectedAmount = 100;

function selectAmount(el, amount) {
    document.querySelectorAll('.amount-item').forEach(function(item) {
        item.classList.remove('active');
    });
    el.classList.add('active');
    selectedAmount = amount;
    document.getElementById('amountInput').value = amount;
    document.getElementById('payAmount').textContent = amount.toFixed(2);
}

// 自定义金额输入同步
document.getElementById('amountInput').addEventListener('input', function() {
    var val = parseFloat(this.value);
    if (isNaN(val) || val <= 0) {
        document.getElementById('payAmount').textContent = '0.00';
        return;
    }
    selectedAmount = val;
    document.getElementById('payAmount').textContent = val.toFixed(2);
    // 取消预设选中
    document.querySelectorAll('.amount-item').forEach(function(item) {
        if (parseFloat(item.dataset.amount) === val) {
            item.classList.add('active');
        } else {
            item.classList.remove('active');
        }
    });
});

function submitRecharge() {
    var amount = parseFloat(document.getElementById('amountInput').value);
    if (isNaN(amount) || amount < 1) {
        alert('请输入至少1元的充值金额');
        return;
    }
    if (amount > 10000) {
        alert('单次充值最高10000元');
        return;
    }
    var btn = document.getElementById('payBtn');
    btn.disabled = true;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 正在生成支付码...';
    window.location.href = '{:U("Home/Balance/pay")}?amount=' + amount.toFixed(2);
}
</script>
</block>
